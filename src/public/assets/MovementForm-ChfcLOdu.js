import{c as g,a as s,o as p,I as x,r as m,w as b,p as R,d as n,j as v,l as w,b as h,J as k,K as I,T as N,L as E,g as C,G as O,n as G,M as Z,N as L,t as S,O as B,F as P,k as U,i as A}from"./index-p-_BGn28.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{S as y,_ as $,a as D}from"./BaseInput-Bb4mBZwM.js";import{u as V}from"./categoriesStore-DA59-nup.js";function ge(t,o){return p(),g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"fill-rule":"evenodd",d:"M1.72 5.47a.75.75 0 0 1 1.06 0L9 11.69l3.756-3.756a.75.75 0 0 1 .985-.066 12.698 12.698 0 0 1 4.575 6.832l.308 1.149 2.277-3.943a.75.75 0 1 1 1.299.75l-3.182 5.51a.75.75 0 0 1-1.025.275l-5.511-3.181a.75.75 0 0 1 .75-1.3l3.943 2.277-.308-1.149a11.194 11.194 0 0 0-3.528-5.617l-3.809 3.81a.75.75 0 0 1-1.06 0L1.72 6.53a.75.75 0 0 1 0-1.061Z","clip-rule":"evenodd"})])}function pe(t,o){return p(),g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"fill-rule":"evenodd",d:"M15.22 6.268a.75.75 0 0 1 .968-.431l5.942 2.28a.75.75 0 0 1 .431.97l-2.28 5.94a.75.75 0 1 1-1.4-.537l1.63-4.251-1.086.484a11.2 11.2 0 0 0-5.45 5.173.75.75 0 0 1-1.199.19L9 12.312l-6.22 6.22a.75.75 0 0 1-1.06-1.061l6.75-6.75a.75.75 0 0 1 1.06 0l3.606 3.606a12.695 12.695 0 0 1 5.68-4.974l1.086-.483-4.251-1.632a.75.75 0 0 1-.432-.97Z","clip-rule":"evenodd"})])}function ve(t,o){return p(),g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{d:"M10.464 8.746c.227-.18.497-.311.786-.394v2.795a2.252 2.252 0 0 1-.786-.393c-.394-.313-.546-.681-.546-1.004 0-.323.152-.691.546-1.004ZM12.75 15.662v-2.824c.347.085.664.228.921.421.427.32.579.686.579.991 0 .305-.152.671-.579.991a2.534 2.534 0 0 1-.921.42Z"}),s("path",{"fill-rule":"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v.816a3.836 3.836 0 0 0-1.72.756c-.712.566-1.112 1.35-1.112 2.178 0 .829.4 1.612 1.113 2.178.502.4 1.102.647 1.719.756v2.978a2.536 2.536 0 0 1-.921-.421l-.879-.66a.75.75 0 0 0-.9 1.2l.879.66c.533.4 1.169.645 1.821.75V18a.75.75 0 0 0 1.5 0v-.81a4.124 4.124 0 0 0 1.821-.749c.745-.559 1.179-1.344 1.179-2.191 0-.847-.434-1.632-1.179-2.191a4.122 4.122 0 0 0-1.821-.75V8.354c.29.082.559.213.786.393l.415.33a.75.75 0 0 0 .933-1.175l-.415-.33a3.836 3.836 0 0 0-1.719-.755V6Z","clip-rule":"evenodd"})])}const F=x("modal",()=>{const t=m(!1),o=m(!1);return b(o,r=>{r&&setTimeout(()=>t.value=!0,150)}),b(t,r=>{r||setTimeout(()=>o.value=!1,300)}),{isRendered:t,showModal:o}}),K={class:"bg-slate-100 dark:bg-gray-900 p-4 rounded-lg shadow-xl w-90"},j={__name:"Modal",setup(t){const o=F(),r=()=>o.isRendered=!1;return(u,i)=>n(o).showModal?(p(),g("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30",onClick:E(r,["self"])},[v(N,{name:"slide-down"},{default:w(()=>[h(s("div",K,[I(u.$slots,"default",{},void 0,!0)],512),[[k,n(o).isRendered]])]),_:3})])):R("",!0)}},ye=H(j,[["__scopeId","data-v-fae993be"]]),T=x("balance",()=>{const t=m(""),o=m(""),r=m({totalIngreso:0,totalGasto:0,balance:0}),i=m(function(){const l=new Date,e=l.getFullYear(),a=String(l.getMonth()+1).padStart(2,"0");return t.value=`${e}-${a}-01 00:00:00`,o.value=new Date(e,a,0).toISOString().split("T")[0]+" 23:59:59",`${e}-${a}`}());b(i,l=>{const[e,a]=l.split("-");t.value=`${e}-${a}-01 00:00:00`,o.value=new Date(e,a,0).toISOString().split("T")[0]+" 23:59:59"}),b([t,o],async()=>await f());const d=l=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}).format(l),f=async()=>{try{const l=await C.get(`/movements/balance?startDate=${t.value}&endDate=${o.value}`);r.value=l.data}catch(l){console.error("Error al obtener el balance:",l),y.fire({title:"Error al obtener balance",icon:"error",toast:!0,position:"top",timer:3e3,showConfirmButton:!1,timerProgressBar:!0})}};return{selectedMonth:i,formatCurrency:d,startDate:t,endDate:o,balance:r,fetchBalance:f}}),q=x("graph",()=>{const t=T(),o=m({labels:[],datasets:[{label:"total",data:[],backgroundColor:["#60a5fa","#f87171","#34d399","#fbbf24","#a78bfa","#fb7185","#facc15","#38bdf8"]}]}),r=m({labels:[],datasets:[{label:"total",data:[],backgroundColor:["#60a5fa","#f87171","#34d399","#fbbf24","#a78bfa","#fb7185","#facc15","#38bdf8"]}]}),u=m(0),i=m(1),d=async()=>{const f=t.startDate,l=t.endDate;try{const e=await C.get(`/stats/totalByCategory?startDate=${f}&endDate=${l}`),{data:a}=e;r.value.labels=a.totalGastoByCategory.map(c=>c.Category.name),r.value.datasets[0].data=a.totalGastoByCategory.map(c=>Number(c.total)),o.value.labels=a.totalIngresoByCategory.map(c=>c.Category.name),o.value.datasets[0].data=a.totalIngresoByCategory.map(c=>Number(c.total)),u.value+=1,i.value+=1}catch(e){console.error("Error al cargar datos del gráfico:",e)}};return b(()=>[t.startDate,t.endDate],()=>d()),{chartDataIngreso:o,chartDataGasto:r,getTotalByCategory:d,chartKeyA:u,chartKeyB:i}}),z=x("movement",()=>{const t=T(),o=q();return{saveMovement:async(u,i)=>{try{return i?await C.put(`/movements/${u.id}`,u):await C.post("/movements",u),t.fetchBalance(),o.getTotalByCategory(t.startDate,t.endDate),!0}catch(d){return console.error("Error al registrar movimiento",d),!1}}}}),Y=()=>{const t=z(),o=F(),r=m({type:"ingreso",amount:"",description:"",CategoryId:""}),u=async l=>{if(r.value.amount=d.value.replace(/\D/g,""),l&&!(await y.fire({title:"¿Desea Editar Registro?",icon:"question",showCancelButton:!0,confirmButtonText:"Sí, Editar",cancelButtonText:"Cancelar",theme:"auto"})).isConfirmed){o.showModal=!1,i(),y.fire({title:"Edicion Cancelada",icon:"success",toast:!0,position:"top",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,theme:"auto"});return}y.fire({title:l?"Editando":"Guardando...",allowOutsideClick:!1,didOpen:()=>{y.showLoading()},theme:"auto"});const e=await t.saveMovement(r.value,l);y.close(),o.isRendered=!1,e?y.fire({title:`Movimiento ${l?"Editado":"Registrado"}`,icon:"success",toast:!0,position:"top",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,theme:"auto"}):y.fire({title:`Error al ${l?"Editar":"Registrar"} movimiento`,icon:"error",toast:!0,position:"top",timer:3e3,showConfirmButton:!1,timerProgressBar:!0,theme:"auto"}),o.showModal=!1,i()},i=()=>{r.value={type:"ingreso",amount:"",description:"",categoryId:"",id:""}},d=m("");function f(l,e=!0){let a=l;if(e&&(a=l.target.value.replace(/\D/g,"")),a===""){d.value="";return}const c=parseInt(a,10);if(isNaN(c)){d.value="";return}const M=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0});d.value=M.format(c)}return{movement:r,submitForm:u,formatearComoMoneda:f,valor:d,modalStore:o}},J=["id","value","placeholder","disabled"],Q="w-full dark:text-gray-200 text-gray-600 px-3 py-2 border rounded-sm focus:outline-none transition duration-300 focus:ring-2",W={__name:"BaseSelect",props:{modelValue:String,placeholder:String,id:String,color:{type:String,default:"primary"},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(t,{emit:o}){const r=t,u={primary:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500",danger:"border-red-300 focus:border-red-500 focus:ring-red-500"},i=O(()=>u[r.color]??u.primary);return(d,f)=>(p(),g("select",{id:t.id,value:t.modelValue,placeholder:t.placeholder,disabled:t.disabled,class:G([Q,i.value,t.disabled?"opacity-50 cursor-not-allowed":""]),onInput:f[0]||(f[0]=l=>d.$emit("update:modelValue",l.target.value))},[I(d.$slots,"default")],42,J))}};function X(t,o){return p(),g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"fill-rule":"evenodd",d:"M10.47 2.22a.75.75 0 0 1 1.06 0l2.25 2.25a.75.75 0 0 1 0 1.06l-2.25 2.25a.75.75 0 1 1-1.06-1.06l.97-.97H5.75a.75.75 0 0 1 0-1.5h5.69l-.97-.97a.75.75 0 0 1 0-1.06Zm-4.94 6a.75.75 0 0 1 0 1.06l-.97.97h5.69a.75.75 0 0 1 0 1.5H4.56l.97.97a.75.75 0 1 1-1.06 1.06l-2.25-2.25a.75.75 0 0 1 0-1.06l2.25-2.25a.75.75 0 0 1 1.06 0Z","clip-rule":"evenodd"})])}const _={class:"mx-auto p-4 border border-gray-300 rounded-lg shadow-lg bg-slate-100 dark:bg-gray-900 dark:text-gray-100 dark:border-gray-700"},ee={class:"text-2xl font-semibold mb-4"},te={class:"flex flex-col w-full"},ae={class:"w-full flex gap-4"},oe={class:"inline-flex items-center gap-2 cursor-pointer"},re={class:"inline-flex items-center gap-2 cursor-pointer"},se={class:"w-full"},le=["value"],ne={class:"w-full"},ie={class:"w-full"},de={class:"flex gap-2"},be={__name:"MovementForm",props:Z(["isEdit","data"],{isEdit:!1}),setup(t){const{formatearComoMoneda:o,movement:r,submitForm:u,valor:i,modalStore:d}=Y(),f=V();return L(async()=>{if(t.isEdit&&t.data){const l=t.data.date,e=new Date(l),a=M=>M.toString().padStart(2,"0"),c=`${e.getFullYear()}-${a(e.getMonth()+1)}-${a(e.getDate())}T${a(e.getHours())}:${a(e.getMinutes())}`;r.value={type:t.data.type,CategoryId:t.data.CategoryId,amount:t.data.amount,description:t.data.description,id:t.data.id,date:c},o(t.data.amount,!1),await V().getCategories()}}),(l,e)=>(p(),g("div",_,[s("h2",ee,S(t.isEdit?"Editar":"Registrar")+" Movimiento",1),s("form",{onSubmit:e[7]||(e[7]=E(a=>n(u)(t.isEdit),["prevent"])),class:"flex flex-col gap-4 items-end",autocomplete:"off"},[h(s("div",te,[e[8]||(e[8]=s("label",{for:"createdAt"},"Fecha",-1)),v($,{id:"createdAt",type:"datetime-local",modelValue:n(r).date,"onUpdate:modelValue":e[0]||(e[0]=a=>n(r).date=a)},null,8,["modelValue"])],512),[[k,t.isEdit]]),s("div",ae,[s("label",oe,[h(s("input",{type:"radio",value:"ingreso","onUpdate:modelValue":e[1]||(e[1]=a=>n(r).type=a),class:"form-radio h-5 w-5"},null,512),[[B,n(r).type]]),e[9]||(e[9]=s("span",{class:""},"Ingreso",-1))]),s("label",re,[h(s("input",{type:"radio",value:"gasto","onUpdate:modelValue":e[2]||(e[2]=a=>n(r).type=a),class:"form-radio h-5 w-5"},null,512),[[B,n(r).type]]),e[10]||(e[10]=s("span",{class:""},"Gasto",-1))])]),s("div",se,[e[12]||(e[12]=s("label",{for:"category",class:"block text-gray-700 dark:text-gray-300"},"Categoría",-1)),v(W,{id:"category",modelValue:n(r).CategoryId,"onUpdate:modelValue":e[3]||(e[3]=a=>n(r).CategoryId=a)},{default:w(()=>[e[11]||(e[11]=s("option",{value:"",disabled:""},"Selecciona una categoría",-1)),(p(!0),g(P,null,U(n(f).categories,a=>(p(),g("option",{key:a.id,value:a.id},S(a.name),9,le))),128))]),_:1},8,["modelValue"])]),s("div",ne,[e[13]||(e[13]=s("label",{for:"amount",class:"block text-gray-700 dark:text-gray-300"},"Monto",-1)),v($,{type:"tel",id:"amount",modelValue:n(i),"onUpdate:modelValue":e[4]||(e[4]=a=>A(i)?i.value=a:null),required:"",onInput:n(o)},null,8,["modelValue","onInput"])]),s("div",ie,[e[14]||(e[14]=s("label",{for:"description",class:"block text-gray-700 dark:text-gray-300"},"Descripción",-1)),v($,{id:"description",modelValue:n(r).description,"onUpdate:modelValue":e[5]||(e[5]=a=>n(r).description=a)},null,8,["modelValue"])]),s("div",de,[v(D,{type:"submit",class:"flex gap-2 items-center"},{default:w(()=>[s("span",null,S(t.isEdit?"Editar":"Crear")+" Movimiento",1),v(n(X),{class:"w-5 inline"})]),_:1}),v(D,{color:"danger",onClick:e[6]||(e[6]=a=>n(d).isRendered=!1)},{default:w(()=>e[15]||(e[15]=[s("span",null,"Cerrar",-1)])),_:1})])],32)]))}};export{ye as M,be as _,T as a,ge as b,ve as c,q as d,pe as r,F as u};
