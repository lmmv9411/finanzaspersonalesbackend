import{c as r,o as s,a as e,y as te,b as i,u as t,F as G,r as H,n as R,t as c,j as Q,l as ae,h as x,m as W,p as se,A as re,i as oe,k as B,w as A,T as ne,q as D,C as le,g as ie,D as F,E as de,G as ce,d as q,v as O}from"./index-yO2uFGIO.js";import{I as ue}from"./iconify-BzKmMHA3.js";import{u as ge,C as me}from"./movementStore-CkiYdafw.js";import{_ as U}from"./BaseButton-C2q9Pt48.js";import{_ as ve}from"./BaseInput-CZ-9GWEk.js";import{u as X}from"./useDates-_yDU2xxL.js";import{g as fe}from"./icons-BjrsL8W4.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as J,a as K,b as xe}from"./CurrencyDollarIcon-BGCMOCJW.js";import{r as ye}from"./ArrowPathIcon-g6fpucu6.js";import"./categoriesStore-Da0OtHEk.js";function be(o,g){return s(),r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M3.792 2.938A49.069 49.069 0 0 1 12 2.25c2.797 0 5.54.236 8.209.688a1.857 1.857 0 0 1 1.541 1.836v1.044a3 3 0 0 1-.879 2.121l-6.182 6.182a1.5 1.5 0 0 0-.439 1.061v2.927a3 3 0 0 1-1.658 2.684l-1.757.878A.75.75 0 0 1 9.75 21v-5.818a1.5 1.5 0 0 0-.44-1.06L3.13 7.938a3 3 0 0 1-.879-2.121V4.774c0-.897.64-1.683 1.542-1.836Z","clip-rule":"evenodd"})])}function he(o,g){return s(),r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{d:"M21.731 2.269a2.625 2.625 0 0 0-3.712 0l-1.157 1.157 3.712 3.712 1.157-1.157a2.625 2.625 0 0 0 0-3.712ZM19.513 8.199l-3.712-3.712-8.4 8.4a5.25 5.25 0 0 0-1.32 2.214l-.8 2.685a.75.75 0 0 0 .933.933l2.685-.8a5.25 5.25 0 0 0 2.214-1.32l8.4-8.4Z"}),e("path",{d:"M5.25 5.25a3 3 0 0 0-3 3v10.5a3 3 0 0 0 3 3h10.5a3 3 0 0 0 3-3V13.5a.75.75 0 0 0-1.5 0v5.25a1.5 1.5 0 0 1-1.5 1.5H5.25a1.5 1.5 0 0 1-1.5-1.5V8.25a1.5 1.5 0 0 1 1.5-1.5h5.25a.75.75 0 0 0 0-1.5H5.25Z"})])}function we(o,g){return s(),r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M16.5 4.478v.227a48.816 48.816 0 0 1 3.878.512.75.75 0 1 1-.256 1.478l-.209-.035-1.005 13.07a3 3 0 0 1-2.991 2.77H8.084a3 3 0 0 1-2.991-2.77L4.087 6.66l-.209.035a.75.75 0 0 1-.256-1.478A48.567 48.567 0 0 1 7.5 4.705v-.227c0-1.564 1.213-2.9 2.816-2.951a52.662 52.662 0 0 1 3.369 0c1.603.051 2.815 1.387 2.815 2.951Zm-6.136-1.452a51.196 51.196 0 0 1 3.273 0C14.39 3.05 15 3.684 15 4.478v.113a49.488 49.488 0 0 0-6 0v-.113c0-.794.609-1.428 1.364-1.452Zm-.355 5.945a.75.75 0 1 0-1.5.058l.347 9a.75.75 0 1 0 1.499-.058l-.346-9Zm5.48.058a.75.75 0 1 0-1.498-.058l-.347 9a.75.75 0 0 0 1.5.058l.345-9Z","clip-rule":"evenodd"})])}function _e(o,g){return s(),r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M14 8a.75.75 0 0 1-.75.75H4.56l3.22 3.22a.75.75 0 1 1-1.06 1.06l-4.5-4.5a.75.75 0 0 1 0-1.06l4.5-4.5a.75.75 0 0 1 1.06 1.06L4.56 7.25h8.69A.75.75 0 0 1 14 8Z","clip-rule":"evenodd"})])}function ke(o,g){return s(),r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M2 8a.75.75 0 0 1 .75-.75h8.69L8.22 4.03a.75.75 0 0 1 1.06-1.06l4.5 4.5a.75.75 0 0 1 0 1.06l-4.5 4.5a.75.75 0 0 1-1.06-1.06l3.22-3.22H2.75A.75.75 0 0 1 2 8Z","clip-rule":"evenodd"})])}const Ce={class:"flex items-center justify-between mt-6"},Pe=["disabled"],Me={class:"flex items-center space-x-2"},$e=["onClick"],Ve=["disabled"],De={__name:"Pagination",props:{currentPage:{type:Number,required:!0},totalPages:{type:Number,required:!0},maxVisiblePages:{type:Number,default:5}},emits:["page-changed"],setup(o,{emit:g}){const l=o,_=g,k=te(()=>{const p=l.currentPage-(l.currentPage-1)%l.maxVisiblePages,m=Math.min(p+l.maxVisiblePages-1,l.totalPages),u=[];for(let h=p;h<=m;h++)u.push(h);return u});function S(){l.currentPage>1&&_("page-changed",l.currentPage-1)}function C(){l.currentPage<l.totalPages&&_("page-changed",l.currentPage+1)}function b(p){p!==l.currentPage&&_("page-changed",p)}return(p,m)=>(s(),r("div",Ce,[e("button",{onClick:S,disabled:o.currentPage===1,class:"cursor-pointer p-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[i(t(_e),{class:"w-5"})],8,Pe),e("div",Me,[(s(!0),r(G,null,H(k.value,u=>(s(),r("button",{key:u,onClick:h=>b(u),class:R({"px-4 py-2 text-sm font-medium rounded-md cursor-pointer":!0,"bg-blue-600 text-white":o.currentPage===u,"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50":o.currentPage!==u})},c(u),11,$e))),128))]),e("button",{onClick:C,disabled:o.currentPage===o.totalPages,class:"cursor-pointer p-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[i(t(ke),{class:"w-5"})],8,Ve)]))}},Se=o=>{const{getTimezoneOffsetString:g}=X(),l=g();return Q.get(`/movements/day?tz=${l}`,{params:o})},Ie=o=>Q.delete(`/movements/${o}`),Ne=ae("movements",()=>{const{showError:o,showConfirm:g,showInfo:l,showLoading:_,showSuccess:k}=se(),{selectedMonth:S,startDate:C,endDate:b,resetToCurrentMonth:p}=X(),m=x([]),u=x(1),h=10,I=x(1),P=x(0),$=x(0),N=x(0),M=new Intl.DateTimeFormat(navigator.language,{weekday:"long"}),Z=new Intl.DateTimeFormat(navigator.language,{month:"long"}),V=x(""),y=x(0),a=x(!1),n=async(E=1)=>{I.value=E,m.value=[],a.value=!0;try{const v=await Se({startDate:C.value,endDate:b.value,page:I.value,pageSize:h,type:V.value,categoryId:y.value||""}),{dias:w}=v.data;m.value=w.map(f=>{const T=new Date(f.fecha_server);f.dia=T.getDate(),f.nombreDia=M.format(T),f.mes=Z.format(T);const{ingresos:Y,gastos:ee}=f.detalles.reduce((L,z)=>(z.type==="ingreso"?L.ingresos+=Number(z.amount):L.gastos+=Number(z.amount),L),{ingresos:0,gastos:0});return f.ingresos=Y,f.gastos=ee,f}),P.value=v.data.totalGasto,$.value=v.data.totalIngreso,N.value=v.data.balance,u.value=v.data.totalPages}catch(v){console.error("Error al cargar movimientos",v),o(`Ocurrió un error ${v.status}`,v.response.data.error)}finally{a.value=!1}},d=async E=>{const{isConfirmed:v}=await g("¿Eliminar Movimiento?","Eliminar","Cancelar");if(!v){l("No se eliminó!");return}_("Eliminando...");try{await Ie(E),m.value=m.value.filter(w=>w.id!==E);for(const w of m.value){const f=w.detalles.findIndex(T=>T.id===E);if(f!==-1){w.detalles.splice(f,1);break}}k("Movimiento Eliminado")}catch(w){console.error("Error al eliminar movimiento",w),o("Error al eliminar movimiento")}},j=()=>{y.value=0,V.value="",p()};return W([C,b,y,V],()=>n()),{movements:m,fetchMovements:n,selectedMonth:S,deleteMovement:d,currentPage:I,totalPages:u,totalGasto:P,totalIngreso:$,balance:N,selectedType:V,selectedCategory:y,isLoading:a,handleReset:j}}),Ee={class:"container mx-auto max-w-3xl py-4 px-2"},Te={class:"mb-4 flex justify-end gap-2"},Be={key:0},Ze={key:0,class:"mb-6 grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-lg"},je={class:"w-full md:col-span-2"},Le={class:"flex gap-2 justify-between mb-6 p-2 dark:bg-gray-800 bg-blue-50 rounded-lg"},ze={class:"dark:text-green-400 dark:text-green-400 text-green-600 font-bold flex gap-1"},Ae={class:"dark:text-red-400 dark:text-red-400 text-red-600 font-bold flex gap-1"},Fe={class:"font-bold dark:text-indigo-200 text-indigo-700 flex gap-1"},Ge={key:0,class:"min-h-[200px] flex items-center justify-center rounded-lg"},He={key:1,class:"text-center py-8 text-gray-500"},Re={key:2},qe={class:"flex flex-col gap-1 justify-between items-end p-3 dark:bg-gray-800 bg-gray-100 rounded-t-lg"},Oe={class:"text-sm text-gray-800 dark:text-gray-200"},Ue={class:"flex gap-4"},Je={key:0,class:"dark:text-green-400 text-green-600 text-xs sm:text-base"},Ke={key:1,class:"dark:text-red-400 text-red-600 text-xs sm:text-base"},Qe={class:"border border-gray-200 dark:border-gray-700 rounded-b-lg divide-y divide-gray-200 dark:divide-gray-700"},We={class:"flex justify-between items-start"},Xe={class:"font-medium flex items-center gap-2 dark:text-gray-200"},Ye={class:"text-sm text-gray-500 mt-1 flex gap-2 items-center"},et={class:"flex flex-col gap-2"},tt={class:"flex gap-2 justify-center items-center"},at=["onClick"],st=["onClick"],rt={__name:"Movements",setup(o){const g=ge(),l=Ne(),{deleteMovement:_,fetchMovements:k,handleReset:S}=l,{movements:C,selectedMonth:b,currentPage:p,totalPages:m,totalGasto:u,totalIngreso:h,balance:I,selectedType:P,selectedCategory:$,isLoading:N}=re(l),M=x(!1),Z=ie(),V=y=>{sessionStorage.setItem("data",JSON.stringify(y)),Z.push({name:"Movement",query:{isEdit:!0}})};return W(()=>g.isSaved,async y=>{y&&await k()}),oe(async()=>await k()),(y,a)=>(s(),r("div",Ee,[e("div",Te,[M.value?(s(),r("div",Be,[i(U,{color:"danger",onClick:t(S),class:"flex gap-2 items-center"},{default:A(()=>[i(t(ye),{class:"w-5 h-5"}),a[4]||(a[4]=e("span",null,"Borrar Filtros",-1))]),_:1},8,["onClick"])])):B("",!0),i(U,{class:"flex items-center gap-2",onClick:a[0]||(a[0]=n=>M.value=!M.value)},{default:A(()=>[i(t(be),{class:"h-4 w-4"}),e("span",null,c(M.value?"Ocultar filtros":"Mostrar filtros"),1)]),_:1})]),i(ne,{name:"filter-slide"},{default:A(()=>[M.value?(s(),r("div",Ze,[e("div",null,[a[5]||(a[5]=e("label",{for:"month-selector",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Mes:",-1)),i(ve,{type:"month",modelValue:t(b),"onUpdate:modelValue":a[1]||(a[1]=n=>F(b)?b.value=n:null),id:"month-selector"},null,8,["modelValue"])]),e("div",null,[a[7]||(a[7]=e("label",{for:"type-filter",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Tipo:",-1)),de(e("select",{id:"type-filter","onUpdate:modelValue":a[2]||(a[2]=n=>F(P)?P.value=n:null),class:"w-full p-2 border border-gray-300 rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white"},a[6]||(a[6]=[e("option",{value:""},"Todos",-1),e("option",{value:"ingreso"},"Ingresos",-1),e("option",{value:"gasto"},"Gastos",-1)]),512),[[ce,t(P)]])]),e("div",je,[a[8]||(a[8]=e("span",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Categoría:",-1)),i(me,{id:"category-filter",type:t(P),modelValue:t($),"onUpdate:modelValue":a[3]||(a[3]=n=>F($)?$.value=n:null),class:"dark:text-gray-100"},null,8,["type","modelValue"])])])):B("",!0)]),_:1}),e("div",Le,[e("div",ze,[i(t(J),{class:"w-6"}),e("span",null,"Ingresos: "+c(t(D)(t(h))),1)]),e("div",Ae,[i(t(K),{class:"w-6"}),e("span",null,"Gastos: "+c(t(D)(t(u))),1)]),e("div",Fe,[i(t(xe),{class:"w-6"}),e("span",null,"Saldo: "+c(t(D)(t(I))),1)])]),t(N)?(s(),r("div",Ge,a[9]||(a[9]=[le('<div class="text-center" data-v-db380d2b><svg class="animate-spin h-8 w-8 text-blue-500 mx-auto mb-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" data-v-db380d2b><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" data-v-db380d2b></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" data-v-db380d2b></path></svg><span class="text-gray-600 dark:text-gray-300" data-v-db380d2b>Cargando movimientos...</span></div>',1)]))):B("",!0),t(C).length===0&&!t(N)?(s(),r("div",He," No hay movimientos para este período ")):(s(),r("div",Re,[(s(!0),r(G,null,H(t(C),n=>(s(),r("div",{key:n.fecha,class:"mb-8"},[e("div",qe,[e("h2",Oe,c(n.nombreDia)+", "+c(n.dia)+" de "+c(n.mes),1),e("div",Ue,[n.ingresos>0?(s(),r("span",Je," Ingresos: +"+c(t(D)(n.ingresos)),1)):B("",!0),n.gastos>0?(s(),r("span",Ke," Gastos: -"+c(t(D)(n.gastos)),1)):B("",!0)])]),e("div",Qe,[(s(!0),r(G,null,H(n.detalles,d=>(s(),r("div",{key:d.id,class:"p-3 hover:bg-gray-200 dark:hover:bg-gray-800 transition-colors duration-300"},[e("div",We,[e("div",null,[e("div",Xe,[d.type==="ingreso"?(s(),q(t(J),{key:0,class:"w-6 text-green-500"})):(s(),q(t(K),{key:1,class:"w-6 text-red-500"})),O(" "+c(d.description),1)]),e("div",Ye,[e("div",{class:R([[t(fe)(d.Category.icon)],"rounded-full p-1 text-white text-lg"])},[i(t(ue),{icon:d.Category.icon},null,8,["icon"])],2),O(" "+c(d.Category.name)+" • "+c(d.type),1)])]),e("div",et,[e("span",{class:R(["font-medium whitespace-nowrap",d.type==="ingreso"?"dark:text-green-400 text-green-600":"dark:text-red-400 text-red-600"])},c((d.type==="gasto"?"-":"")+t(D)(d.amount)),3),e("div",tt,[e("button",{onClick:j=>V(d),class:"dark:text-blue-400 text-blue-500 hover:text-blue-700 cursor-pointer",title:"Editar movimiento"},[i(t(he),{class:"h-5 w-5"})],8,at),e("button",{onClick:j=>t(_)(d.id),class:"dark:text-red-400 text-red-500 hover:text-red-700 ml-2 cursor-pointer",title:"Eliminar movimiento"},[i(t(we),{class:"h-5 w-5"})],8,st)])])])]))),128))])]))),128))])),i(De,{currentPage:t(p),totalPages:t(m),onPageChanged:t(k)},null,8,["currentPage","totalPages","onPageChanged"])]))}},pt=pe(rt,[["__scopeId","data-v-db380d2b"]]);export{pt as default};
