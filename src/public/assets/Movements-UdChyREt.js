import{c as n,o as r,a as e,z as oe,b as d,u as s,F as X,r as O,n as L,t as g,i as Y,k as re,l as y,m as ee,p as ne,s as le,h as ie,C as de,j as N,w as Z,T as q,q as S,D as ce,g as ue,E as R,G as ge,H as me,I as fe,d as U,x as J,A as z}from"./index-Bynz4OC3.js";import{I as ve}from"./iconify-KYVFi5b4.js";import{u as pe,C as xe}from"./movementStore-COGUpbD5.js";import{_ as K}from"./BaseButton-DAiFdybT.js";import{_ as he}from"./BaseInput-Bs69CCxs.js";import{u as te}from"./useDates-C5zOx99y.js";import{r as ye,g as be}from"./icons-DFPeI9cY.js";import{_ as we}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as _e,a as ke}from"./ArrowTrendingUpIcon-OaWUXw0l.js";import"./categoriesStore-Dyd8t4Ft.js";function Ce(l,v){return r(),n("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M3.792 2.938A49.069 49.069 0 0 1 12 2.25c2.797 0 5.54.236 8.209.688a1.857 1.857 0 0 1 1.541 1.836v1.044a3 3 0 0 1-.879 2.121l-6.182 6.182a1.5 1.5 0 0 0-.439 1.061v2.927a3 3 0 0 1-1.658 2.684l-1.757.878A.75.75 0 0 1 9.75 21v-5.818a1.5 1.5 0 0 0-.44-1.06L3.13 7.938a3 3 0 0 1-.879-2.121V4.774c0-.897.64-1.683 1.542-1.836Z","clip-rule":"evenodd"})])}function Q(l,v){return r(),n("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{d:"M21.731 2.269a2.625 2.625 0 0 0-3.712 0l-1.157 1.157 3.712 3.712 1.157-1.157a2.625 2.625 0 0 0 0-3.712ZM19.513 8.199l-3.712-3.712-8.4 8.4a5.25 5.25 0 0 0-1.32 2.214l-.8 2.685a.75.75 0 0 0 .933.933l2.685-.8a5.25 5.25 0 0 0 2.214-1.32l8.4-8.4Z"}),e("path",{d:"M5.25 5.25a3 3 0 0 0-3 3v10.5a3 3 0 0 0 3 3h10.5a3 3 0 0 0 3-3V13.5a.75.75 0 0 0-1.5 0v5.25a1.5 1.5 0 0 1-1.5 1.5H5.25a1.5 1.5 0 0 1-1.5-1.5V8.25a1.5 1.5 0 0 1 1.5-1.5h5.25a.75.75 0 0 0 0-1.5H5.25Z"})])}function W(l,v){return r(),n("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M16.5 4.478v.227a48.816 48.816 0 0 1 3.878.512.75.75 0 1 1-.256 1.478l-.209-.035-1.005 13.07a3 3 0 0 1-2.991 2.77H8.084a3 3 0 0 1-2.991-2.77L4.087 6.66l-.209.035a.75.75 0 0 1-.256-1.478A48.567 48.567 0 0 1 7.5 4.705v-.227c0-1.564 1.213-2.9 2.816-2.951a52.662 52.662 0 0 1 3.369 0c1.603.051 2.815 1.387 2.815 2.951Zm-6.136-1.452a51.196 51.196 0 0 1 3.273 0C14.39 3.05 15 3.684 15 4.478v.113a49.488 49.488 0 0 0-6 0v-.113c0-.794.609-1.428 1.364-1.452Zm-.355 5.945a.75.75 0 1 0-1.5.058l.347 9a.75.75 0 1 0 1.499-.058l-.346-9Zm5.48.058a.75.75 0 1 0-1.498-.058l-.347 9a.75.75 0 0 0 1.5.058l.345-9Z","clip-rule":"evenodd"})])}function Pe(l,v){return r(),n("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M14 8a.75.75 0 0 1-.75.75H4.56l3.22 3.22a.75.75 0 1 1-1.06 1.06l-4.5-4.5a.75.75 0 0 1 0-1.06l4.5-4.5a.75.75 0 0 1 1.06 1.06L4.56 7.25h8.69A.75.75 0 0 1 14 8Z","clip-rule":"evenodd"})])}function Me(l,v){return r(),n("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M2 8a.75.75 0 0 1 .75-.75h8.69L8.22 4.03a.75.75 0 0 1 1.06-1.06l4.5 4.5a.75.75 0 0 1 0 1.06l-4.5 4.5a.75.75 0 0 1-1.06-1.06l3.22-3.22H2.75A.75.75 0 0 1 2 8Z","clip-rule":"evenodd"})])}const $e={class:"flex items-center justify-between mt-6"},Te=["disabled"],Ve={class:"flex items-center space-x-2"},Se=["onClick"],De=["disabled"],Ie={__name:"Pagination",props:{currentPage:{type:Number,required:!0},totalPages:{type:Number,required:!0},maxVisiblePages:{type:Number,default:5}},emits:["page-changed"],setup(l,{emit:v}){const i=l,b=v,k=oe(()=>{const h=i.currentPage-(i.currentPage-1)%i.maxVisiblePages,x=Math.min(h+i.maxVisiblePages-1,i.totalPages),m=[];for(let _=h;_<=x;_++)m.push(_);return m});function D(){i.currentPage>1&&b("page-changed",i.currentPage-1)}function C(){i.currentPage<i.totalPages&&b("page-changed",i.currentPage+1)}function w(h){h!==i.currentPage&&b("page-changed",h)}return(h,x)=>(r(),n("div",$e,[e("button",{onClick:D,disabled:l.currentPage===1,class:"cursor-pointer p-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[d(s(Pe),{class:"w-5"})],8,Te),e("div",Ve,[(r(!0),n(X,null,O(k.value,m=>(r(),n("button",{key:m,onClick:_=>w(m),class:L({"px-4 py-2 text-sm font-medium rounded-md cursor-pointer":!0,"bg-blue-600 text-white":l.currentPage===m,"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50":l.currentPage!==m})},g(m),11,Se))),128))]),e("button",{onClick:C,disabled:l.currentPage===l.totalPages,class:"cursor-pointer p-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[d(s(Me),{class:"w-5"})],8,De)]))}},Ee=l=>{const{getTimezoneOffsetString:v}=te(),i=v();return Y.get(`/movements/day?tz=${i}`,{params:l})},Ne=l=>Y.delete(`/movements/${l}`),je=re("movements",()=>{const{showError:l,showConfirm:v,showInfo:i,showLoading:b,showSuccess:k}=ne(),{selectedMonth:D,startDate:C,endDate:w,resetToCurrentMonth:h}=te(),x=y([]),m=y(1),_=10,I=y(1),P=y(0),T=y(0),E=y(0),M=new Intl.DateTimeFormat(navigator.language,{weekday:"long"}),A=new Intl.DateTimeFormat(navigator.language,{month:"long"}),$=y(""),p=y(0),V=y(!1),j=t=>t.replace(/^\w/,a=>a.toUpperCase()),B=async(t=1)=>{I.value=t,x.value=[],V.value=!0;try{const a=await Ee({startDate:C.value,endDate:w.value,page:I.value,pageSize:_,type:$.value,categoryId:p.value||""}),{dias:o}=a.data;x.value=o.map(f=>{const u=new Date(f.fecha_server);f.dia=u.getDate(),f.nombreDia=j(M.format(u)),f.mes=j(A.format(u));const{ingresos:se,gastos:ae}=f.detalles.reduce((G,H)=>(H.type==="ingreso"?G.ingresos+=Number(H.amount):G.gastos+=Number(H.amount),G),{ingresos:0,gastos:0});return f.ingresos=se,f.gastos=ae,f}),P.value=a.data.totalGasto,T.value=a.data.totalIngreso,E.value=a.data.balance,m.value=a.data.totalPages}catch(a){console.error("Error al cargar movimientos",a),l(`Ocurrió un error ${a.status}`,a.response.data.error)}finally{V.value=!1}},F=async t=>{const{isConfirmed:a}=await v("¿Eliminar Movimiento?","Eliminar","Cancelar");if(!a){i("No se eliminó!");return}b("Eliminando...");try{await Ne(t),x.value=x.value.filter(o=>o.id!==t);for(const o of x.value){const f=o.detalles.findIndex(u=>u.id===t);if(f!==-1){o.detalles.splice(f,1);break}}k("Movimiento Eliminado")}catch(o){console.error("Error al eliminar movimiento",o),l("Error al eliminar movimiento")}},c=()=>{p.value=0,$.value="",h()};return ee([C,w,p,$],()=>B()),{movements:x,fetchMovements:B,selectedMonth:D,deleteMovement:F,currentPage:I,totalPages:m,totalGasto:P,totalIngreso:T,balance:E,selectedType:$,selectedCategory:p,isLoading:V,handleReset:c}}),Be={class:"container mx-auto max-w-3xl py-4 px-2"},Ze={class:"mb-4 flex justify-end gap-2"},ze={key:0},Le={key:0,class:"mb-6 grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-lg"},Ae={class:"w-full md:col-span-2"},Fe={class:"flex flex-wrap gap-2 mb-6 p-2 dark:bg-gray-800 bg-blue-50 rounded-lg"},Ge={class:"dark:text-green-400 dark:text-green-400 text-green-600 font-bold flex gap-1 items-center flex-1 flex-col"},He={class:"dark:text-red-400 dark:text-red-400 text-red-600 font-bold flex gap-1 items-center flex-1 flex-col"},Re={class:"dark:text-indigo-200 text-indigo-700 font-bold flex gap-1 items-center flex-1 flex-col"},Xe={key:0,class:"min-h-[200px] flex items-center justify-center rounded-lg"},Oe={key:1,class:"text-center py-8 text-gray-500"},qe={key:2},Ue={class:"flex gap-1 justify-between items-center p-2 dark:bg-gray-800 bg-gray-100 rounded-t-lg"},Je={class:"text-xs sm:text-base text-gray-800 dark:text-gray-200"},Ke={class:"flex gap-2"},Qe={key:0,class:"dark:text-green-400 text-green-600 text-xs sm:text-base"},We={key:1,class:"dark:text-red-400 text-red-600 text-xs sm:text-base"},Ye={class:"border border-gray-200 dark:border-gray-700 rounded-b-lg divide-y divide-gray-200 dark:divide-gray-700"},et=["onTouchmove","onTouchend"],tt={class:"w-full p-3 hover:bg-gray-200 dark:hover:bg-gray-800 flex justify-between items-center gap-4 transition-colors duration-300"},st={class:"flex justify-between items-center w-full"},at={class:"font-medium flex items-center gap-2 dark:text-gray-200"},ot={class:"text-sm text-gray-500 mt-1 flex gap-2 items-center"},rt={class:"hidden sm:flex gap-2"},nt=["onClick"],lt=["onClick"],it={class:"sm:hidden flex w-[158px] shrink-0"},dt=["onClick"],ct=["onClick"],ut={__name:"Movements",setup(l){const v=pe(),i=je(),{deleteMovement:b,fetchMovements:k,handleReset:D}=i,{movements:C,selectedMonth:w,currentPage:h,totalPages:x,totalGasto:m,totalIngreso:_,balance:I,selectedType:P,selectedCategory:T,isLoading:E}=le(i),M=y(!1),A=ue(),$=c=>{sessionStorage.setItem("data",JSON.stringify(c)),A.push({name:"Movement",query:{isEdit:!0}})};ee(()=>v.isSaved,async c=>{c&&await k()}),ie(async()=>await k());const p=de({});let V=0;const j=c=>{V=c.touches[0].clientX},B=(c,t)=>{const o=c.touches[0].clientX-V;o<0&&o>-120&&(p[t]=o),o>0&&p[t]&&(p[t]=o)},F=c=>{const t=p[c]||0;p[c]=t<-100?-195:0,t>0&&(p[c]=0)};return(c,t)=>(r(),n("div",Be,[e("div",Ze,[d(q,{name:"button-slide"},{default:Z(()=>[M.value?(r(),n("div",ze,[d(K,{color:"danger",onClick:s(D),class:"flex gap-2 items-center"},{default:Z(()=>[d(s(ye),{class:"w-5 h-5"}),t[5]||(t[5]=e("span",null,"Borrar Filtros",-1))]),_:1},8,["onClick"])])):N("",!0)]),_:1}),d(K,{class:"flex items-center gap-2",onClick:t[0]||(t[0]=a=>M.value=!M.value)},{default:Z(()=>[d(s(Ce),{class:"h-4 w-4"}),e("span",null,g(M.value?"Ocultar filtros":"Mostrar filtros"),1)]),_:1})]),d(q,{name:"filter-slide"},{default:Z(()=>[M.value?(r(),n("div",Le,[e("div",null,[t[6]||(t[6]=e("label",{for:"month-selector",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Mes:",-1)),d(he,{type:"month",modelValue:s(w),"onUpdate:modelValue":t[1]||(t[1]=a=>R(w)?w.value=a:null),id:"month-selector"},null,8,["modelValue"])]),e("div",null,[t[8]||(t[8]=e("label",{for:"type-filter",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Tipo:",-1)),ge(e("select",{id:"type-filter","onUpdate:modelValue":t[2]||(t[2]=a=>R(P)?P.value=a:null),class:"w-full p-2 border border-gray-300 rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white"},t[7]||(t[7]=[e("option",{value:""},"Todos",-1),e("option",{value:"ingreso"},"Ingresos",-1),e("option",{value:"gasto"},"Gastos",-1)]),512),[[me,s(P)]])]),e("div",Ae,[t[9]||(t[9]=e("span",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Categoría:",-1)),d(xe,{id:"category-filter",type:s(P),modelValue:s(T),"onUpdate:modelValue":t[3]||(t[3]=a=>R(T)?T.value=a:null),class:"dark:text-gray-100"},null,8,["type","modelValue"])])])):N("",!0)]),_:1}),e("div",Fe,[e("div",Ge,[t[10]||(t[10]=e("span",null,"Ingresos:",-1)),e("span",null,g(s(S)(s(_))),1)]),e("div",He,[t[11]||(t[11]=e("span",null,"Gastos:",-1)),e("span",null,g(s(S)(s(m))),1)]),e("div",Re,[t[12]||(t[12]=e("span",null,"Saldo:",-1)),e("span",null,g(s(S)(s(I))),1)])]),s(E)?(r(),n("div",Xe,t[13]||(t[13]=[ce('<div class="text-center" data-v-600863d5><svg class="animate-spin h-8 w-8 text-blue-500 mx-auto mb-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" data-v-600863d5><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" data-v-600863d5></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" data-v-600863d5></path></svg><span class="text-gray-600 dark:text-gray-300" data-v-600863d5>Cargando movimientos...</span></div>',1)]))):N("",!0),s(C).length===0&&!s(E)?(r(),n("div",Oe," No hay movimientos para este período ")):(r(),n("div",qe,[(r(!0),n(X,null,O(s(C),a=>(r(),n("div",{key:a.fecha,class:"mb-8"},[e("div",Ue,[e("h2",Je,g(a.nombreDia)+", "+g(a.dia)+" De "+g(a.mes),1),e("div",Ke,[a.ingresos>0?(r(),n("span",Qe," Ingresos: "+g(s(S)(a.ingresos)),1)):N("",!0),a.gastos>0?(r(),n("span",We," Gastos: "+g(s(S)(a.gastos)),1)):N("",!0)])]),e("div",Ye,[(r(!0),n(X,null,O(a.detalles,(o,f)=>(r(),n("div",{key:o.id,class:"overflow-x-hidden block",onTouchstart:t[4]||(t[4]=u=>j(u)),onTouchmove:u=>B(u,o.id),onTouchend:u=>F(o.id)},[e("div",{class:"flex w-[calc(100%+158px)] sm:w-full transition-transform duration-100",style:fe({transform:`translateX(${p[o.id]||0}px)`})},[e("div",tt,[e("div",st,[e("div",null,[e("div",at,[o.type==="ingreso"?(r(),U(s(_e),{key:0,class:"w-6 text-green-500"})):(r(),U(s(ke),{key:1,class:"w-6 text-red-500"})),J(" "+g(o.description),1)]),e("div",ot,[e("div",{class:L([[s(be)(o.Category.icon)],"rounded-full p-1 text-white text-lg"])},[d(s(ve),{icon:o.Category.icon},null,8,["icon"])],2),J(" "+g(o.Category.name)+" • "+g(o.type),1)])]),e("span",{class:L(["font-medium whitespace-nowrap",o.type==="ingreso"?"dark:text-green-400 text-green-600":"dark:text-red-400 text-red-600"])},g((o.type==="gasto"?"-":"")+s(S)(o.amount)),3)]),e("div",rt,[e("button",{onClick:z(u=>$(o),["stop"]),class:"w-6 flex items-center justify-center text-blue-500 hover:text-blue-600 cursor-pointer",title:"Editar movimiento"},[d(s(Q),{class:"h-6 w-6"})],8,nt),e("button",{onClick:z(u=>s(b)(o.id),["stop"]),class:"w-6 flex items-center justify-center text-red-500 hover:text-red-600 cursor-pointer",title:"Eliminar movimiento"},[d(s(W),{class:"h-6 w-6"})],8,lt)])]),e("div",it,[e("button",{onClick:z(u=>$(o),["stop"]),class:"w-full flex gap-2 p-2 items-center justify-center text-white bg-blue-500"},[d(s(Q),{class:"h-5 w-5"}),t[14]||(t[14]=e("span",null,"Editar",-1))],8,dt),e("button",{onClick:z(u=>s(b)(o.id),["stop"]),class:L(["w-full flex gap-2 p-2 items-center justify-center text-white bg-red-500",[f===a.detalles.length-1?"rounded-br-lg":""]])},[d(s(W),{class:"h-5 w-5"}),t[15]||(t[15]=e("span",null,"Eliminar",-1))],10,ct)])],4)],40,et))),128))])]))),128))])),d(Ie,{currentPage:s(h),totalPages:s(x),onPageChanged:s(k)},null,8,["currentPage","totalPages","onPageChanged"])]))}},_t=we(ut,[["__scopeId","data-v-600863d5"]]);export{_t as default};
