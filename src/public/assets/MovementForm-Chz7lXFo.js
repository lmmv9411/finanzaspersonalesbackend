import{z as S,r as m,g as C,_ as N,c as b,A as O,u,o as v,b as g,w as p,p as V,B as I,a as i,C as E,T as G,D as F,m as w,E as P,n as U,G as A,H as z,t as D,F as L,y as q,x as H,I as M}from"./index-BiocdtAb.js";import{S as y,u as $}from"./categoriesStore-D9gdB92r.js";import{_ as h,a as B}from"./BaseInput-B21l2rAc.js";const T=S("modal",()=>{const t=m(!1),r=m(!1);return C(r,o=>{o&&setTimeout(()=>t.value=!0,150)}),C(t,o=>{o||setTimeout(()=>r.value=!1,300)}),{isRendered:t,showModal:r}}),K={class:"bg-slate-100 dark:bg-gray-900 p-4 rounded-lg shadow-xl w-90"},Y={__name:"Modal",setup(t){const r=T(),o=()=>r.isRendered=!1;return(d,n)=>u(r).showModal?(v(),b("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30",onClick:F(o,["self"])},[g(G,{name:"slide-down"},{default:p(()=>[V(i("div",K,[E(d.$slots,"default",{},void 0,!0)],512),[[I,u(r).isRendered]])]),_:3})])):O("",!0)}},ue=N(Y,[["__scopeId","data-v-fae993be"]]),R=S("balance",()=>{const t=m(""),r=m(""),o=m({totalIngreso:0,totalGasto:0,balance:0}),n=m(function(){const s=new Date,e=s.getFullYear(),a=String(s.getMonth()+1).padStart(2,"0");return t.value=`${e}-${a}-01 00:00:00`,r.value=new Date(e,a,0).toISOString().split("T")[0]+" 23:59:59",`${e}-${a}`}());C(n,s=>{const[e,a]=s.split("-");t.value=`${e}-${a}-01 00:00:00`,r.value=new Date(e,a,0).toISOString().split("T")[0]+" 23:59:59"}),C([t,r],async()=>await f());const l=s=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}).format(s),f=async()=>{try{const s=await w.get(`/movements/balance?startDate=${t.value}&endDate=${r.value}`);o.value=s.data}catch(s){console.error("Error al obtener el balance:",s),y.fire({title:"Error al obtener balance",icon:"error",toast:!0,position:"top",timer:3e3,showConfirmButton:!1,timerProgressBar:!0})}};return{selectedMonth:n,formatCurrency:l,startDate:t,endDate:r,balance:o,fetchBalance:f}}),j=S("graph",()=>{const t=R(),r=m({labels:[],datasets:[{label:"total",data:[],backgroundColor:["#60a5fa","#f87171","#34d399","#fbbf24","#a78bfa","#fb7185","#facc15","#38bdf8"]}]}),o=m({labels:[],datasets:[{label:"total",data:[],backgroundColor:["#60a5fa","#f87171","#34d399","#fbbf24","#a78bfa","#fb7185","#facc15","#38bdf8"]}]}),d=m(0),n=m(1),l=async()=>{const f=t.startDate,s=t.endDate;try{const e=await w.get(`/stats/totalByCategory?startDate=${f}&endDate=${s}`),{data:a}=e;o.value.labels=a.totalGastoByCategory.map(c=>c.Category.name),o.value.datasets[0].data=a.totalGastoByCategory.map(c=>Number(c.total)),r.value.labels=a.totalIngresoByCategory.map(c=>c.Category.name),r.value.datasets[0].data=a.totalIngresoByCategory.map(c=>Number(c.total)),d.value+=1,n.value+=1}catch(e){console.error("Error al cargar datos del gráfico:",e)}};return C(()=>[t.startDate,t.endDate],()=>l()),{chartDataIngreso:r,chartDataGasto:o,getTotalByCategory:l,chartKeyA:d,chartKeyB:n}}),J=S("movement",()=>{const t=R(),r=j();return{saveMovement:async(d,n)=>{try{return n?await w.put(`/movements/${d.id}`,d):await w.post("/movements",d),t.fetchBalance(),r.getTotalByCategory(t.startDate,t.endDate),!0}catch(l){return console.error("Error al registrar movimiento",l),!1}}}}),Q=()=>{const t=J(),r=T(),o=m({type:"ingreso",amount:"",description:"",CategoryId:""}),d=async s=>{if(o.value.amount=l.value.replace(/\D/g,""),s&&!(await y.fire({title:"¿Desea Editar Registro?",icon:"question",showCancelButton:!0,confirmButtonText:"Sí, Editar",cancelButtonText:"Cancelar",theme:"auto"})).isConfirmed){r.showModal=!1,n(),y.fire({title:"Edicion Cancelada",icon:"success",toast:!0,position:"top",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,theme:"auto"});return}y.fire({title:s?"Editando":"Guardando...",allowOutsideClick:!1,didOpen:()=>{y.showLoading()},theme:"auto"});const e=await t.saveMovement(o.value,s);y.close(),r.isRendered=!1,e?y.fire({title:`Movimiento ${s?"Editado":"Registrado"}`,icon:"success",toast:!0,position:"top",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,theme:"auto"}):y.fire({title:`Error al ${s?"Editar":"Registrar"} movimiento`,icon:"error",toast:!0,position:"top",timer:3e3,showConfirmButton:!1,timerProgressBar:!0,theme:"auto"}),r.showModal=!1,n()},n=()=>{o.value={type:"ingreso",amount:"",description:"",categoryId:"",id:""}},l=m("");function f(s,e=!0){let a=s;if(e&&(a=s.target.value.replace(/\D/g,"")),a===""){l.value="";return}const c=parseInt(a,10);if(isNaN(c)){l.value="";return}const x=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0});l.value=x.format(c)}return{movement:o,submitForm:d,formatearComoMoneda:f,valor:l,modalStore:r}},W=["id","value","type","placeholder","disabled"],X="w-full dark:text-gray-200 text-gray-600 px-3 py-2 border rounded-sm focus:outline-none transition duration-300 focus:ring-2",k={__name:"BaseSelect",props:{modelValue:String,placeholder:String,id:String,type:{type:String,default:"text"},color:{type:String,default:"primary"},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(t,{emit:r}){const o=t,d={primary:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500",danger:"border-red-300 focus:border-red-500 focus:ring-red-500"},n=P(()=>d[o.color]??d.primary);return(l,f)=>(v(),b("select",{id:t.id,value:t.modelValue,type:t.type,placeholder:t.placeholder,disabled:t.disabled,class:U([X,n.value,t.disabled?"opacity-50 cursor-not-allowed":""]),onInput:f[0]||(f[0]=s=>l.$emit("update:modelValue",s.target.value))},[E(l.$slots,"default")],42,W))}},Z={class:"mx-auto p-4 border border-gray-300 rounded-lg shadow-lg bg-slate-100 dark:bg-gray-900 dark:text-gray-100 dark:border-gray-700"},_={class:"text-2xl font-semibold mb-4"},ee={class:"flex flex-col w-full"},te={class:"w-full"},ae={class:"w-full"},oe=["value"],re={class:"w-full"},se={class:"w-full"},ne={class:"flex gap-2"},ce={__name:"MovementForm",props:A(["isEdit","data"],{isEdit:!1}),setup(t){const{formatearComoMoneda:r,movement:o,submitForm:d,valor:n,modalStore:l}=Q(),f=$();return z(async()=>{if(t.isEdit&&t.data){const s=t.data.date,e=new Date(s),a=x=>x.toString().padStart(2,"0"),c=`${e.getFullYear()}-${a(e.getMonth()+1)}-${a(e.getDate())}T${a(e.getHours())}:${a(e.getMinutes())}`;o.value={type:t.data.type,CategoryId:t.data.CategoryId,amount:t.data.amount,description:t.data.description,id:t.data.id,date:c},r(t.data.amount,!1),await $().getCategories()}}),(s,e)=>(v(),b("div",Z,[i("h2",_,D(t.isEdit?"Editar":"Registrar")+" Movimiento",1),i("form",{onSubmit:e[6]||(e[6]=F(a=>u(d)(t.isEdit),["prevent"])),class:"flex flex-col gap-4 items-end",autocomplete:"off"},[V(i("div",ee,[e[7]||(e[7]=i("label",{for:"createdAt"},"Fecha",-1)),g(h,{id:"createdAt",type:"datetime-local",modelValue:u(o).date,"onUpdate:modelValue":e[0]||(e[0]=a=>u(o).date=a)},null,8,["modelValue"])],512),[[I,t.isEdit]]),i("div",te,[e[9]||(e[9]=i("label",{for:"type",class:"block text-gray-700 dark:text-gray-300"},"Tipo de Movimiento",-1)),g(k,{id:"type",modelValue:u(o).type,"onUpdate:modelValue":e[1]||(e[1]=a=>u(o).type=a)},{default:p(()=>e[8]||(e[8]=[i("option",{value:"ingreso"},"Ingreso",-1),i("option",{value:"gasto"},"Gasto",-1)])),_:1},8,["modelValue"])]),i("div",ae,[e[11]||(e[11]=i("label",{for:"category",class:"block text-gray-700 dark:text-gray-300"},"Categoría",-1)),g(k,{id:"category",modelValue:u(o).CategoryId,"onUpdate:modelValue":e[2]||(e[2]=a=>u(o).CategoryId=a)},{default:p(()=>[e[10]||(e[10]=i("option",{value:"",disabled:""},"Selecciona una categoría",-1)),(v(!0),b(L,null,q(u(f).categories,a=>(v(),b("option",{key:a.id,value:a.id},D(a.name),9,oe))),128))]),_:1},8,["modelValue"])]),i("div",re,[e[12]||(e[12]=i("label",{for:"amount",class:"block text-gray-700 dark:text-gray-300"},"Monto",-1)),g(h,{type:"tel",id:"amount",modelValue:u(n),"onUpdate:modelValue":e[3]||(e[3]=a=>H(n)?n.value=a:null),required:"",onInput:u(r)},null,8,["modelValue","onInput"])]),i("div",se,[e[13]||(e[13]=i("label",{for:"description",class:"block text-gray-700 dark:text-gray-300"},"Descripción",-1)),g(h,{id:"description",modelValue:u(o).description,"onUpdate:modelValue":e[4]||(e[4]=a=>u(o).description=a)},null,8,["modelValue"])]),i("div",ne,[g(B,{type:"submit"},{default:p(()=>[M(D(t.isEdit?"Editar":"Registrar")+" Movimiento",1)]),_:1}),g(B,{color:"danger",onClick:e[5]||(e[5]=a=>u(l).isRendered=!1)},{default:p(()=>e[14]||(e[14]=[M("Cerrar")])),_:1})])],32)]))}};export{ue as M,ce as _,R as a,j as b,T as u};
