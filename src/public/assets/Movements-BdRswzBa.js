import{c as u,o as g,a as e,r as f,g as $,d as k,m as _,p as B,b,u as i,F as v,q as C,n as P,t as w,x as S,y as D,z as E,w as F}from"./index-BqgEXKb7.js";import{u as N,M as O,_ as T}from"./MovementForm-DWthZlGR.js";import{S as h}from"./BaseInput-D9cxo6dM.js";import{r as V,a as L}from"./TrashIcon-DsAm5vOc.js";import"./categoriesStore-C4QAM-xE.js";function q(s,l){return g(),u("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M14 8a.75.75 0 0 1-.75.75H4.56l3.22 3.22a.75.75 0 1 1-1.06 1.06l-4.5-4.5a.75.75 0 0 1 0-1.06l4.5-4.5a.75.75 0 0 1 1.06 1.06L4.56 7.25h8.69A.75.75 0 0 1 14 8Z","clip-rule":"evenodd"})])}function z(s,l){return g(),u("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M2 8a.75.75 0 0 1 .75-.75h8.69L8.22 4.03a.75.75 0 0 1 1.06-1.06l4.5 4.5a.75.75 0 0 1 0 1.06l-4.5 4.5a.75.75 0 0 1-1.06-1.06l3.22-3.22H2.75A.75.75 0 0 1 2 8Z","clip-rule":"evenodd"})])}const A=()=>{const s=f([]),l=f(""),a=f(""),c=f(""),d=f(1),y=10,m=f(1),p=async(o=1)=>{m.value=o;try{const t=await _.get(`/movements/date?startDate=${a.value}&endDate=${c.value}&page=${m.value}&pageSize=${y}`);s.value=t.data.data,d.value=t.data.totalPages}catch(t){console.error("Error al cargar movimientos",t),h.fire({title:"Ocurrió un error "+t.status,text:t.response.data.error,icon:"error",theme:"auto",timer:3500,showConfirmButton:!1,timerProgressBar:!0,toast:!0,position:"top"})}},n=async o=>{if(!(await h.fire({title:"Eliminar Movimiento?",icon:"question",showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar",theme:"auto"})).isConfirmed){h.fire({title:"No se eliminó!",icon:"info",timer:2e3,theme:"auto",toast:!0,position:"top",showConfirmButton:!1,timerProgressBar:!0});return}h.fire({title:"Eliminando...",allowOutsideClick:!1,didOpen:()=>{h.showLoading()}});try{await _.delete(`/movements/${o}`),s.value=s.value.filter(r=>r.id!==o),h.fire({title:"Movimiento Eliminado",icon:"success",toast:!0,position:"top",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,theme:"auto"})}catch(r){console.error("Error al eliminar movimiento",r),h.fire({title:"Error al eliminar movimiento",icon:"error",toast:!0,position:"top",timer:3e3,showConfirmButton:!1,timerProgressBar:!0,theme:"auto"})}},x=function(){const o=new Date,t=o.getFullYear(),r=String(o.getMonth()+1).padStart(2,"0");a.value=`${t}-${r}-01`,c.value=new Date(t,r,0).toISOString().split("T")[0],l.value=`${t}-${r}`};return $(l,o=>{const[t,r]=o.split("-");a.value=`${t}-${r}-01 00:00:00`,c.value=new Date(t,r,0).toISOString().split("T")[0]+" 23:59:59",p()}),k(()=>x()),{movements:s,fetchMovements:p,selectedMonth:l,deleteMovement:n,currentPage:m,totalPages:d,fetchMovements:p}},I={class:"flex items-center justify-between mt-6"},j=["disabled"],H={class:"flex items-center space-x-2"},R=["onClick"],Z=["disabled"],U={__name:"Pagination",props:{currentPage:{type:Number,required:!0},totalPages:{type:Number,required:!0},maxVisiblePages:{type:Number,default:5}},emits:["page-changed"],setup(s,{emit:l}){const a=s,c=l,d=B(()=>{const n=a.currentPage-(a.currentPage-1)%a.maxVisiblePages,x=Math.min(n+a.maxVisiblePages-1,a.totalPages),o=[];for(let t=n;t<=x;t++)o.push(t);return o});function y(){a.currentPage>1&&c("page-changed",a.currentPage-1)}function m(){a.currentPage<a.totalPages&&c("page-changed",a.currentPage+1)}function p(n){n!==a.currentPage&&c("page-changed",n)}return(n,x)=>(g(),u("div",I,[e("button",{onClick:y,disabled:s.currentPage===1,class:"cursor-pointer p-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[b(i(q),{class:"w-5"})],8,j),e("div",H,[(g(!0),u(v,null,C(d.value,o=>(g(),u("button",{key:o,onClick:t=>p(o),class:P({"px-4 py-2 text-sm font-medium rounded-md cursor-pointer":!0,"bg-blue-600 text-white":s.currentPage===o,"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50":s.currentPage!==o})},w(o),11,R))),128))]),e("button",{onClick:m,disabled:s.currentPage===s.totalPages,class:"cursor-pointer p-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[b(i(z),{class:"w-5"})],8,Z)]))}},Y={class:"shadow-md p-4 rounded dark:bg-gray-800 bg-slate-100 flex gap-2 dark:text-gray-300 items-start sm:flex-row sm:items-end w-fit m-auto flex-wrap"},G={class:"flex flex-row items-center gap-4"},J={class:"w-full mx-auto p-4 overflow-x-auto"},K={class:"dark:text-white w-full table-auto border-collapse whitespace-nowrap text-lg"},Q={class:"p-4"},W={class:"p-4"},X={class:"p-4"},ee={class:"p-4"},te={class:"flex gap-2 justify-center items-center"},re=["onClick"],oe=["onClick"],ce={__name:"Movements",setup(s){const l=N(),a=f({}),c=o=>{a.value=o,l.showModal=!0},{selectedMonth:d,movements:y,deleteMovement:m,currentPage:p,totalPages:n,fetchMovements:x}=A();return(o,t)=>(g(),u(v,null,[t[3]||(t[3]=e("h2",{class:"mx-auto dark:text-white w-fit text-2xl font-semibold mt-4"},"Movimientos Registrados",-1)),e("div",Y,[e("div",G,[t[1]||(t[1]=e("label",{for:"selectedMonth",class:"block text-gray-700 dark:text-gray-300"},"Filtrar Mes",-1)),S(e("input",{"onUpdate:modelValue":t[0]||(t[0]=r=>E(d)?d.value=r:null),type:"month",id:"selectedMonth",class:"p-2 border border-gray-300 dark:bg-gray-900 dark:border-gray-700 border-2 focus:border-gray-300 focus:outline-none focus:border-gray-500 rounded transition-colors duration-300"},null,512),[[D,i(d)]])])]),e("div",J,[e("table",K,[t[2]||(t[2]=e("thead",null,[e("tr",{class:"border-b border-gray-400"},[e("th",{class:"px-4 py-2"},"Tipo"),e("th",{class:"px-4 py-2"},"Monto"),e("th",{class:"px-4 py-2"},"Descripción"),e("th",{class:"px-4 py-2"},"Categoría"),e("th",{class:"px-4 py-2"},"Fecha"),e("th",{class:"px-4 py-2"},"Acciones")])],-1)),e("tbody",null,[(g(!0),u(v,null,C(i(y),r=>(g(),u("tr",{key:r.id,class:"border-b border-gray-300"},[e("td",Q,[e("span",{class:P(["font-bold",{"text-green-600":r.type==="ingreso","text-red-600":r.type!=="ingreso"}])},w(r.type),3)]),e("td",{class:P(["p-4",{"text-green-600":r.type==="ingreso","text-red-600":r.type!=="ingreso"}])},w(new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}).format(r.type==="gasto"?r.amount*-1:r.amount)),3),e("td",W,w(r.description),1),e("td",X,w(r.Category.name),1),e("td",ee,w(new Date(r.date).toLocaleString()),1),e("td",null,[e("div",te,[e("button",{onClick:M=>c(r),class:"text-blue-500 hover:text-blue-700 cursor-pointer",title:"Editar movimiento"},[b(i(V),{class:"h-5 w-5"})],8,re),e("button",{onClick:M=>i(m)(r.id),class:"text-red-500 hover:text-red-700 ml-2 cursor-pointer",title:"Eliminar movimiento"},[b(i(L),{class:"h-5 w-5"})],8,oe)])])]))),128))])])]),b(U,{currentPage:i(p),totalPages:i(n),onPageChanged:i(x)},null,8,["currentPage","totalPages","onPageChanged"]),b(O,null,{default:F(()=>[b(T,{isEdit:"true",data:a.value},null,8,["data"])]),_:1})],64))}};export{ce as default};
