import{c as g,a as r,o as p,J as C,r as f,w as y,p as _,d as c,j as v,l as w,b as h,K as k,L as E,T as N,M as I,g as x,s as $,H as Z,n as G,N as L,O as U,t as M,P as B,F as O,k as P,i as H}from"./index-DposHvDK.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{S as b,_ as S}from"./BaseInput-DW968MtN.js";import{u as D}from"./categoriesStore-C9XKH5ic.js";import{_ as V}from"./BaseButton-BFgXVqK2.js";function ve(t,a){return p(),g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[r("path",{"fill-rule":"evenodd",d:"M1.72 5.47a.75.75 0 0 1 1.06 0L9 11.69l3.756-3.756a.75.75 0 0 1 .985-.066 12.698 12.698 0 0 1 4.575 6.832l.308 1.149 2.277-3.943a.75.75 0 1 1 1.299.75l-3.182 5.51a.75.75 0 0 1-1.025.275l-5.511-3.181a.75.75 0 0 1 .75-1.3l3.943 2.277-.308-1.149a11.194 11.194 0 0 0-3.528-5.617l-3.809 3.81a.75.75 0 0 1-1.06 0L1.72 6.53a.75.75 0 0 1 0-1.061Z","clip-rule":"evenodd"})])}function be(t,a){return p(),g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[r("path",{"fill-rule":"evenodd",d:"M15.22 6.268a.75.75 0 0 1 .968-.431l5.942 2.28a.75.75 0 0 1 .431.97l-2.28 5.94a.75.75 0 1 1-1.4-.537l1.63-4.251-1.086.484a11.2 11.2 0 0 0-5.45 5.173.75.75 0 0 1-1.199.19L9 12.312l-6.22 6.22a.75.75 0 0 1-1.06-1.061l6.75-6.75a.75.75 0 0 1 1.06 0l3.606 3.606a12.695 12.695 0 0 1 5.68-4.974l1.086-.483-4.251-1.632a.75.75 0 0 1-.432-.97Z","clip-rule":"evenodd"})])}function ye(t,a){return p(),g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[r("path",{d:"M10.464 8.746c.227-.18.497-.311.786-.394v2.795a2.252 2.252 0 0 1-.786-.393c-.394-.313-.546-.681-.546-1.004 0-.323.152-.691.546-1.004ZM12.75 15.662v-2.824c.347.085.664.228.921.421.427.32.579.686.579.991 0 .305-.152.671-.579.991a2.534 2.534 0 0 1-.921.42Z"}),r("path",{"fill-rule":"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v.816a3.836 3.836 0 0 0-1.72.756c-.712.566-1.112 1.35-1.112 2.178 0 .829.4 1.612 1.113 2.178.502.4 1.102.647 1.719.756v2.978a2.536 2.536 0 0 1-.921-.421l-.879-.66a.75.75 0 0 0-.9 1.2l.879.66c.533.4 1.169.645 1.821.75V18a.75.75 0 0 0 1.5 0v-.81a4.124 4.124 0 0 0 1.821-.749c.745-.559 1.179-1.344 1.179-2.191 0-.847-.434-1.632-1.179-2.191a4.122 4.122 0 0 0-1.821-.75V8.354c.29.082.559.213.786.393l.415.33a.75.75 0 0 0 .933-1.175l-.415-.33a3.836 3.836 0 0 0-1.719-.755V6Z","clip-rule":"evenodd"})])}const T=C("modal",()=>{const t=f(!1),a=f(!1);return y(a,s=>{s&&setTimeout(()=>t.value=!0,150)}),y(t,s=>{s||setTimeout(()=>a.value=!1,300)}),{isRendered:t,showModal:a}}),A={class:"bg-slate-100 dark:bg-gray-900 p-4 rounded-lg shadow-xl w-90"},K={__name:"Modal",setup(t){const a=T(),s=()=>a.isRendered=!1;return(l,m)=>c(a).showModal?(p(),g("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30",onClick:I(s,["self"])},[v(N,{name:"slide-down"},{default:w(()=>[h(r("div",A,[E(l.$slots,"default",{},void 0,!0)],512),[[k,c(a).isRendered]])]),_:3})])):_("",!0)}},we=q(K,[["__scopeId","data-v-fae993be"]]);function j(t,a){return p(),g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[r("path",{"fill-rule":"evenodd",d:"M10.47 2.22a.75.75 0 0 1 1.06 0l2.25 2.25a.75.75 0 0 1 0 1.06l-2.25 2.25a.75.75 0 1 1-1.06-1.06l.97-.97H5.75a.75.75 0 0 1 0-1.5h5.69l-.97-.97a.75.75 0 0 1 0-1.06Zm-4.94 6a.75.75 0 0 1 0 1.06l-.97.97h5.69a.75.75 0 0 1 0 1.5H4.56l.97.97a.75.75 0 1 1-1.06 1.06l-2.25-2.25a.75.75 0 0 1 0-1.06l2.25-2.25a.75.75 0 0 1 1.06 0Z","clip-rule":"evenodd"})])}const R=C("balance",()=>{const t=f(""),a=f(""),s=f({totalIngreso:0,totalGasto:0,balance:0}),m=f(function(){const u=new Date,i=u.getFullYear(),d=String(u.getMonth()+1).padStart(2,"0");return t.value=`${i}-${d}-01 00:00:00`,a.value=new Date(i,d,0).toISOString().split("T")[0]+" 23:59:59",`${i}-${d}`}());y(m,u=>{const[i,d]=u.split("-");t.value=`${i}-${d}-01 00:00:00`,a.value=new Date(i,d,0).toISOString().split("T")[0]+" 23:59:59"}),y([t,a],async()=>await n());const n=async()=>{try{const u=await x.get(`/movements/balance?startDate=${t.value}&endDate=${a.value}`);s.value=u.data}catch(u){console.error("Error al obtener el balance:",u),b.fire({title:"Error al obtener balance",icon:"error",toast:!0,position:"top",timer:3e3,showConfirmButton:!1,timerProgressBar:!0})}};return{selectedMonth:m,startDate:t,endDate:a,balance:s,fetchBalance:n}}),z=C("graph",()=>{const t=R(),a=f({labels:[],datasets:[{label:"total",data:[],backgroundColor:["#60a5fa","#f87171","#34d399","#fbbf24","#a78bfa","#fb7185","#facc15","#38bdf8"]}]}),s=f({labels:[],datasets:[{label:"total",data:[],backgroundColor:["#60a5fa","#f87171","#34d399","#fbbf24","#a78bfa","#fb7185","#facc15","#38bdf8"]}]}),l=f(0),m=f(1),n=async()=>{const u=t.startDate,i=t.endDate;try{const d=await x.get(`/stats/totalByCategory?startDate=${u}&endDate=${i}`),{data:e}=d;s.value.labels=e.totalGastoByCategory.map(o=>o.Category.name),s.value.datasets[0].data=e.totalGastoByCategory.map(o=>Number(o.total)),a.value.labels=e.totalIngresoByCategory.map(o=>o.Category.name),a.value.datasets[0].data=e.totalIngresoByCategory.map(o=>Number(o.total)),l.value+=1,m.value+=1}catch(d){console.error("Error al cargar datos del gráfico:",d)}};return y(()=>[t.startDate,t.endDate],()=>n()),{chartDataIngreso:a,chartDataGasto:s,getTotalByCategory:n,chartKeyA:l,chartKeyB:m}}),Y=C("movement",()=>{const t=R(),a=z(),s=f(!1),l=f({});return{saveMovement:async(n,u)=>{try{u?await x.put(`/movements/${n.id}`,n):await x.post("/movements",n),t.fetchBalance(),a.getTotalByCategory(t.startDate,t.endDate),s.value=!0,l.value=n}catch(i){s.value=!1,console.error("Error al registrar movimiento",i)}},isSaved:s,mov:l}}),J=()=>{const t=Y(),a=T(),s=f({type:"ingreso",amount:"",description:"",CategoryId:""}),l=async i=>{if(s.value.amount=n.value.replace(/\D/g,""),i&&!(await b.fire({title:"¿Desea Editar Registro?",icon:"question",showCancelButton:!0,confirmButtonText:"Sí, Editar",cancelButtonText:"Cancelar",theme:"auto"})).isConfirmed){a.showModal=!1,m(),b.fire({title:"Edicion Cancelada",icon:"success",toast:!0,position:"top",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,theme:"auto"});return}b.fire({title:i?"Editando":"Guardando...",allowOutsideClick:!1,didOpen:()=>{b.showLoading()},theme:"auto"}),await t.saveMovement(s.value,i),b.close(),a.isRendered=!1,t.isSaved?b.fire({title:`Movimiento ${i?"Editado":"Registrado"}`,icon:"success",toast:!0,position:"top",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,theme:"auto"}):b.fire({title:`Error al ${i?"Editar":"Registrar"} movimiento`,icon:"error",toast:!0,position:"top",timer:3e3,showConfirmButton:!1,timerProgressBar:!0,theme:"auto"}),a.showModal=!1,m()},m=()=>{s.value={type:"ingreso",amount:"",description:"",categoryId:"",id:""},t.isSaved=!1},n=f("");function u(i){const d=i.target.value.replace(/\D/g,"");if(d===""){n.value="";return}const e=parseInt(d,10);if(isNaN(e)){n.value="";return}n.value=$(e)}return{movement:s,submitForm:l,handleInput:u,valor:n,modalStore:a,formatoMoneda:$}},Q=["id","value","placeholder","disabled"],W="w-full dark:text-gray-200 text-gray-600 px-3 py-2 border-2 dark:border-gray-700 rounded-sm focus:outline-none transition duration-300 focus:ring-2",X={__name:"BaseSelect",props:{modelValue:{required:!0},placeholder:String,id:String,color:{type:String,default:"primary"},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(t,{emit:a}){const s=t,l={primary:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500",danger:"border-red-300 focus:border-red-500 focus:ring-red-500"},m=Z(()=>l[s.color]??l.primary);return(n,u)=>(p(),g("select",{id:t.id,value:t.modelValue,placeholder:t.placeholder,disabled:t.disabled,class:G([W,m.value,t.disabled?"opacity-50 cursor-not-allowed":""]),onInput:u[0]||(u[0]=i=>n.$emit("update:modelValue",i.target.value))},[E(n.$slots,"default")],42,Q))}},ee={class:"mx-auto p-4 border border-gray-300 rounded-lg shadow-lg bg-slate-100 dark:bg-gray-900 dark:text-gray-100 dark:border-gray-700"},te={class:"text-2xl font-semibold mb-4"},ae={class:"flex flex-col w-full"},oe={class:"w-full flex gap-4"},re={class:"inline-flex items-center gap-2 cursor-pointer"},se={class:"inline-flex items-center gap-2 cursor-pointer"},le={class:"w-full"},ne=["value"],ie={class:"w-full"},de={class:"w-full"},ue={class:"flex gap-2"},he={__name:"MovementForm",props:L(["isEdit","data"],{isEdit:!1}),setup(t){const{handleInput:a,formatoMoneda:s,movement:l,submitForm:m,valor:n,modalStore:u}=J(),i=D();return U(async()=>{if(t.isEdit&&t.data){const d=new Date(t.data.date),e=F=>F.toString().padStart(2,"0"),o=`${d.getFullYear()}-${e(d.getMonth()+1)}-${e(d.getDate())}T${e(d.getHours())}:${e(d.getMinutes())}`;l.value={...t.data,date:o},n.value=s(t.data.amount),await D().getCategories()}}),(d,e)=>(p(),g("div",ee,[r("h2",te,M(t.isEdit?"Editar":"Registrar")+" Movimiento",1),r("form",{onSubmit:e[7]||(e[7]=I(o=>c(m)(t.isEdit),["prevent"])),class:"flex flex-col gap-4 items-end",autocomplete:"off"},[h(r("div",ae,[e[8]||(e[8]=r("label",{for:"createdAt"},"Fecha",-1)),v(S,{id:"createdAt",type:"datetime-local",modelValue:c(l).date,"onUpdate:modelValue":e[0]||(e[0]=o=>c(l).date=o)},null,8,["modelValue"])],512),[[k,t.isEdit]]),r("div",oe,[r("label",re,[h(r("input",{id:"ingreso",type:"radio",value:"ingreso","onUpdate:modelValue":e[1]||(e[1]=o=>c(l).type=o),class:"form-radio h-5 w-5"},null,512),[[B,c(l).type]]),e[9]||(e[9]=r("span",null,"Ingreso",-1))]),r("label",se,[h(r("input",{id:"gasto",type:"radio",value:"gasto","onUpdate:modelValue":e[2]||(e[2]=o=>c(l).type=o),class:"form-radio h-5 w-5"},null,512),[[B,c(l).type]]),e[10]||(e[10]=r("span",null,"Gasto",-1))])]),r("div",le,[e[12]||(e[12]=r("label",{for:"category",class:"block text-gray-700 dark:text-gray-300"},"Categoría",-1)),v(X,{id:"category",modelValue:c(l).CategoryId,"onUpdate:modelValue":e[3]||(e[3]=o=>c(l).CategoryId=o)},{default:w(()=>[e[11]||(e[11]=r("option",{value:"",disabled:""},"Selecciona una categoría",-1)),(p(!0),g(O,null,P(c(i).categories,o=>(p(),g("option",{key:o.id,value:o.id},M(o.name),9,ne))),128))]),_:1},8,["modelValue"])]),r("div",ie,[e[13]||(e[13]=r("label",{for:"amount",class:"block text-gray-700 dark:text-gray-300"},"Monto",-1)),v(S,{type:"tel",id:"amount",modelValue:c(n),"onUpdate:modelValue":e[4]||(e[4]=o=>H(n)?n.value=o:null),required:"",onInput:c(a)},null,8,["modelValue","onInput"])]),r("div",de,[e[14]||(e[14]=r("label",{for:"description",class:"block text-gray-700 dark:text-gray-300"},"Descripción",-1)),v(S,{id:"description",modelValue:c(l).description,"onUpdate:modelValue":e[5]||(e[5]=o=>c(l).description=o),modelModifiers:{trim:!0}},null,8,["modelValue"])]),r("div",ue,[v(V,{type:"submit",class:"flex gap-2 items-center"},{default:w(()=>[r("span",null,M(t.isEdit?"Editar":"Crear")+" Movimiento",1),v(c(j),{class:"w-5 inline"})]),_:1}),v(V,{color:"danger",onClick:e[6]||(e[6]=o=>c(u).isRendered=!1)},{default:w(()=>e[15]||(e[15]=[r("span",null,"Cerrar",-1)])),_:1})])],32)]))}};export{we as M,he as _,R as a,ve as b,ye as c,z as d,Y as e,be as r,T as u};
