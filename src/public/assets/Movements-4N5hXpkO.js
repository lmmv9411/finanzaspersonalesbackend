import{r as p,g as _,d as M,m as y,c as x,a as e,b as m,p as C,q as k,u as d,x as $,F as w,y as B,w as D,o as g,n as b,t as u}from"./index-6yIVpIIz.js";import{u as S,M as E,_ as F}from"./MovementForm-uLDNT8Ls.js";import{S as n}from"./BaseInput-HaCwFjNR.js";import{r as O,a as T}from"./TrashIcon-CkBttpBc.js";import"./categoriesStore-Crxyu36l.js";const N=()=>{const i=p([]),l=p(""),r=p(""),c=p(""),a=async()=>{try{const s=await y.get(`/movements/date?startDate=${r.value}&endDate=${c.value}`);i.value=s.data}catch(s){console.error("Error al cargar movimientos",s)}},f=async s=>{if(!(await n.fire({title:"Eliminar Movimiento?",icon:"question",showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar",theme:"auto"})).isConfirmed){n.fire({title:"No se eliminó!",icon:"info",timer:2e3,theme:"auto",toast:!0,position:"top",showConfirmButton:!1,timerProgressBar:!0});return}n.fire({title:"Eliminando...",allowOutsideClick:!1,didOpen:()=>{n.showLoading()}});try{await y.delete(`/movements/${s}`),i.value=i.value.filter(t=>t.id!==s),n.fire({title:"Movimiento Eliminado",icon:"success",toast:!0,position:"top",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,theme:"auto"})}catch(t){console.error("Error al eliminar movimiento",t),n.fire({title:"Error al eliminar movimiento",icon:"error",toast:!0,position:"top",timer:3e3,showConfirmButton:!1,timerProgressBar:!0,theme:"auto"})}},h=function(){const s=new Date,o=s.getFullYear(),t=String(s.getMonth()+1).padStart(2,"0");r.value=`${o}-${t}-01`,c.value=new Date(o,t,0).toISOString().split("T")[0],l.value=`${o}-${t}`};return _(l,s=>{const[o,t]=s.split("-");r.value=`${o}-${t}-01 00:00:00`,c.value=new Date(o,t,0).toISOString().split("T")[0]+" 23:59:59",a()}),M(()=>h()),{movements:i,fetchMovements:a,selectedMonth:l,deleteMovement:f}},P={class:"shadow-md p-4 rounded dark:bg-gray-800 bg-slate-100 flex gap-2 dark:text-gray-300 items-start sm:flex-row sm:items-end w-fit m-auto flex-wrap"},I={class:"flex flex-row items-center gap-4"},L={class:"w-full max-w-4xl mx-auto p-4 overflow-x-auto"},V={class:"dark:text-white w-full table-auto border-collapse whitespace-nowrap text-lg"},q={class:"p-4"},R={class:"px-4 py-2"},j={class:"px-4 py-2"},z={class:"px-4 py-2"},A={class:"px-4 py-2 flex gap-2 justify-center"},U=["onClick"],Y=["onClick"],W={__name:"Movements",setup(i){const l=S(),r=p({}),c=s=>{r.value=s,l.showModal=!0},{selectedMonth:a,movements:f,deleteMovement:h}=N();return(s,o)=>(g(),x(w,null,[o[3]||(o[3]=e("h2",{class:"mx-auto dark:text-white w-fit text-2xl font-semibold mt-4"},"Movimientos Registrados",-1)),e("div",P,[e("div",I,[o[1]||(o[1]=e("label",{for:"selectedMonth",class:"block text-gray-700 dark:text-gray-300"},"Filtrar Mes",-1)),C(e("input",{"onUpdate:modelValue":o[0]||(o[0]=t=>$(a)?a.value=t:null),type:"month",id:"selectedMonth",class:"p-2 border border-gray-300 dark:bg-gray-900 dark:border-gray-700 border-2 focus:border-gray-300 focus:outline-none focus:border-gray-500 rounded transition-colors duration-300"},null,512),[[k,d(a)]])])]),e("div",L,[e("table",V,[o[2]||(o[2]=e("thead",null,[e("tr",{class:"border-b border-gray-400"},[e("th",{class:"px-4 py-2"},"Tipo"),e("th",{class:"px-4 py-2"},"Monto"),e("th",{class:"px-4 py-2"},"Descripción"),e("th",{class:"px-4 py-2"},"Categoría"),e("th",{class:"px-4 py-2"},"Fecha"),e("th",{class:"px-4 py-2"},"Acciones")])],-1)),e("tbody",null,[(g(!0),x(w,null,B(d(f),t=>(g(),x("tr",{key:t.id,class:"border-b border-gray-300"},[e("td",q,[e("span",{class:b(["font-bold",{"text-green-600":t.type==="ingreso","text-red-600":t.type!=="ingreso"}])},u(t.type),3)]),e("td",{class:b(["px-4 py-2",{"text-green-600":t.type==="ingreso","text-red-600":t.type!=="ingreso"}])},u(new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}).format(t.type==="gasto"?t.amount*-1:t.amount)),3),e("td",R,u(t.description),1),e("td",j,u(t.Category.name),1),e("td",z,u(new Date(t.date).toLocaleString()),1),e("td",A,[e("button",{onClick:v=>c(t),class:"text-blue-500 hover:text-blue-700 cursor-pointer",title:"Editar movimiento"},[m(d(O),{class:"h-5 w-5"})],8,U),e("button",{onClick:v=>d(h)(t.id),class:"text-red-500 hover:text-red-700 ml-2 cursor-pointer",title:"Eliminar movimiento"},[m(d(T),{class:"h-5 w-5"})],8,Y)])]))),128))])])]),m(E,null,{default:D(()=>[m(F,{isEdit:"true",data:r.value},null,8,["data"])]),_:1})],64))}};export{W as default};
