import{c as l,o as c,a as t,r as m,w as F,f as O,g as I,G,j as v,d as i,F as D,k as N,n as E,t as n,i as L,l as q,p as V,H as z}from"./index-CrESaIQ-.js";import{S as _,_ as H}from"./BaseInput-DOhtZsyb.js";import{u as A,M as Z,_ as R}from"./MovementForm-DiUId9-W.js";import{r as U,a as Y}from"./TrashIcon-Df9ahzNj.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./categoriesStore-DTO08hQ_.js";function J(o,f){return c(),l("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"fill-rule":"evenodd",d:"M14 8a.75.75 0 0 1-.75.75H4.56l3.22 3.22a.75.75 0 1 1-1.06 1.06l-4.5-4.5a.75.75 0 0 1 0-1.06l4.5-4.5a.75.75 0 0 1 1.06 1.06L4.56 7.25h8.69A.75.75 0 0 1 14 8Z","clip-rule":"evenodd"})])}function K(o,f){return c(),l("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"fill-rule":"evenodd",d:"M2 8a.75.75 0 0 1 .75-.75h8.69L8.22 4.03a.75.75 0 0 1 1.06-1.06l4.5 4.5a.75.75 0 0 1 0 1.06l-4.5 4.5a.75.75 0 0 1-1.06-1.06l3.22-3.22H2.75A.75.75 0 0 1 2 8Z","clip-rule":"evenodd"})])}const Q=()=>{const o=m([]),f=m(""),a=m(""),h=m(""),w=m(1),C=10,y=m(1),P=m(0),d=m(0),p=m(0),u=new Intl.DateTimeFormat(navigator.language,{weekday:"long"}),x=new Intl.DateTimeFormat(navigator.language,{month:"long"}),$=async(r=1)=>{y.value=r;try{const e=await I.get(`/movements/day?startDate=${a.value}&endDate=${h.value}&page=${y.value}&pageSize=${C}`),{dias:s}=e.data;o.value=s.map(g=>{const M=new Date(g.fecha);g.dia=M.getDate(),g.nombreDia=u.format(M),g.mes=x.format(M);const{ingresos:j,gastos:T}=g.detalles.reduce((B,S)=>(S.type==="ingreso"?B.ingresos+=Number(S.amount):B.gastos+=Number(S.amount),B),{ingresos:0,gastos:0});return g.ingresos=j,g.gastos=T,g}),P.value=e.data.totalGasto,d.value=e.data.totalIngreso,p.value=e.data.balance,w.value=e.data.totalPages}catch(e){console.error("Error al cargar movimientos",e),_.fire({title:"Ocurrió un error "+e.status,text:e.response.data.error,icon:"error",theme:"auto",timer:3500,showConfirmButton:!1,timerProgressBar:!0,toast:!0,position:"top"})}},b=async r=>{if(!(await _.fire({title:"Eliminar Movimiento?",icon:"question",showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar",theme:"auto"})).isConfirmed){_.fire({title:"No se eliminó!",icon:"info",timer:2e3,theme:"auto",toast:!0,position:"top",showConfirmButton:!1,timerProgressBar:!0});return}_.fire({title:"Eliminando...",allowOutsideClick:!1,didOpen:()=>{_.showLoading()},theme:"auto"});try{await I.delete(`/movements/${r}`),o.value=o.value.filter(s=>s.id!==r),_.fire({title:"Movimiento Eliminado",icon:"success",toast:!0,position:"top",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,theme:"auto"})}catch(s){console.error("Error al eliminar movimiento",s),_.fire({title:"Error al eliminar movimiento",icon:"error",toast:!0,position:"top",timer:3e3,showConfirmButton:!1,timerProgressBar:!0,theme:"auto"})}},k=function(){const r=new Date,e=r.getFullYear(),s=String(r.getMonth()+1).padStart(2,"0");a.value=`${e}-${s}-01`,h.value=new Date(e,s,0).toISOString().split("T")[0],f.value=`${e}-${s}`};return F(f,r=>{const[e,s]=r.split("-");a.value=`${e}-${s}-01 00:00:00`,h.value=new Date(e,s,0).toISOString().split("T")[0]+" 23:59:59",$()}),O(()=>k()),{movements:o,fetchMovements:$,selectedMonth:f,deleteMovement:b,currentPage:y,totalPages:w,fetchMovements:$,totalGasto:P,totalIngreso:d,balance:p}},W={class:"flex items-center justify-between mt-6"},X=["disabled"],ee={class:"flex items-center space-x-2"},te=["onClick"],se=["disabled"],ae={__name:"Pagination",props:{currentPage:{type:Number,required:!0},totalPages:{type:Number,required:!0},maxVisiblePages:{type:Number,default:5}},emits:["page-changed"],setup(o,{emit:f}){const a=o,h=f,w=G(()=>{const d=a.currentPage-(a.currentPage-1)%a.maxVisiblePages,p=Math.min(d+a.maxVisiblePages-1,a.totalPages),u=[];for(let x=d;x<=p;x++)u.push(x);return u});function C(){a.currentPage>1&&h("page-changed",a.currentPage-1)}function y(){a.currentPage<a.totalPages&&h("page-changed",a.currentPage+1)}function P(d){d!==a.currentPage&&h("page-changed",d)}return(d,p)=>(c(),l("div",W,[t("button",{onClick:C,disabled:o.currentPage===1,class:"cursor-pointer p-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[v(i(J),{class:"w-5"})],8,X),t("div",ee,[(c(!0),l(D,null,N(w.value,u=>(c(),l("button",{key:u,onClick:x=>P(u),class:E({"px-4 py-2 text-sm font-medium rounded-md cursor-pointer":!0,"bg-blue-600 text-white":o.currentPage===u,"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50":o.currentPage!==u})},n(u),11,te))),128))]),t("button",{onClick:y,disabled:o.currentPage===o.totalPages,class:"cursor-pointer p-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[v(i(K),{class:"w-5"})],8,se)]))}},oe={class:"container mx-auto max-w-3xl"},re={class:"mb-6 flex items-center gap-4"},ne={class:"flex flex-col justify-between items-center mb-6 p-4 dark:bg-gray-800 bg-blue-50 rounded-lg"},ie={class:"flex gap-4"},le={class:"text-green-600 font-bold"},ce={class:"text-red-600 font-bold"},de={class:"font-bold dark:text-blue-200 text-blue-700"},ue={key:0,class:"text-center py-8 text-gray-500"},ge={key:1},me={class:"flex flex-col gap-1 justify-between items-end p-3 dark:bg-gray-800 bg-gray-100 rounded-t-lg"},fe={class:"text-sm text-gray-800 dark:text-gray-200"},he={class:"flex gap-4"},pe={key:0,class:"text-green-600 text-xs sm:text-base"},xe={key:1,class:"text-red-600 text-xs sm:text-base"},be={class:"border border-gray-200 dark:border-gray-700 rounded-b-lg divide-y divide-gray-200 dark:divide-gray-700"},ve={class:"flex justify-between items-start"},ye={class:"font-medium flex items-center gap-2 dark:text-gray-200"},_e={class:"text-sm text-gray-500 mt-1 ml-8"},we={class:"flex flex-col gap-2"},Pe={class:"flex gap-2 justify-center items-center"},ke=["onClick"],Ce=["onClick"],Ee={__name:"Movements",setup(o){const f=A(),a=m({}),h=k=>{a.value=k,f.showModal=!0},{deleteMovement:w,currentPage:C,totalPages:y,fetchMovements:P,selectedMonth:d,movements:p,totalGasto:u,totalIngreso:x,balance:$}=Q(),b=k=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}).format(k);return(k,r)=>(c(),l(D,null,[t("div",oe,[t("div",re,[r[1]||(r[1]=t("label",{for:"month-selector",class:"font-medium text-gray-700"},"Mes:",-1)),v(H,{type:"month",modelValue:i(d),"onUpdate:modelValue":r[0]||(r[0]=e=>L(d)?d.value=e:null),id:"month-selector"},null,8,["modelValue"])]),t("div",ne,[t("div",ie,[t("div",le," Ingresos: "+n(b(i(x))),1),t("div",ce," Gastos: "+n(b(i(u))),1),t("div",de," Saldo: "+n(b(i($))),1)])]),i(p).length===0?(c(),l("div",ue," No hay movimientos para este período ")):(c(),l("div",ge,[(c(!0),l(D,null,N(i(p),e=>(c(),l("div",{key:e.fecha,class:"mb-8"},[t("div",me,[t("h2",fe,n(e.nombreDia)+", "+n(e.dia)+" de "+n(e.mes),1),t("div",he,[e.ingresos>0?(c(),l("span",pe," Ingresos: +"+n(b(e.ingresos)),1)):V("",!0),e.gastos>0?(c(),l("span",xe," Gastos: -"+n(b(e.gastos)),1)):V("",!0)])]),t("div",be,[(c(!0),l(D,null,N(e.detalles,s=>{var g;return c(),l("div",{key:s.id,class:"p-3 hover:bg-gray-200 dark:hover:bg-gray-800 transition-colors duration-300"},[t("div",ve,[t("div",null,[t("div",ye,[t("span",{class:E(["w-6 h-6 rounded-full flex items-center justify-center",s.type==="ingreso"?"bg-green-100 text-green-600":"bg-red-100 text-red-600"])},n(s.type==="ingreso"?"↑":"↓"),3),z(" "+n(s.description),1)]),t("div",_e,n((g=s.Category)==null?void 0:g.name)+" • "+n(s.type),1)]),t("div",we,[t("span",{class:E(["font-medium whitespace-nowrap",s.type==="ingreso"?"text-green-600":"text-red-600"])},n((s.type==="gasto"?"-":"")+b(s.amount)),3),t("div",Pe,[t("button",{onClick:M=>h(s),class:"text-blue-500 hover:text-blue-700 cursor-pointer",title:"Editar movimiento"},[v(i(U),{class:"h-5 w-5"})],8,ke),t("button",{onClick:M=>i(w)(s.id),class:"text-red-500 hover:text-red-700 ml-2 cursor-pointer",title:"Eliminar movimiento"},[v(i(Y),{class:"h-5 w-5"})],8,Ce)])])])])}),128))])]))),128))])),v(ae,{currentPage:i(C),totalPages:i(y),onPageChanged:i(P)},null,8,["currentPage","totalPages","onPageChanged"])]),v(Z,null,{default:q(()=>[v(R,{isEdit:"true",data:a.value},null,8,["data"])]),_:1})],64))}};export{Ee as default};
