import{c,o,a as e,r as x,w as F,f as H,g as E,G as L,j as h,d as s,F as $,k as V,n as O,t as u,i as q,l as z,p as I,m as Z,H as A}from"./index-ytOTDY5P.js";import{S as y,_ as R}from"./BaseInput-B-1BT49V.js";import{u as U,e as Y,r as T,b as j,c as J,M as K,_ as Q}from"./MovementForm-ocdISsaw.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./categoriesStore-COYFAbW_.js";function W(n,m){return o(),c("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{d:"M21.731 2.269a2.625 2.625 0 0 0-3.712 0l-1.157 1.157 3.712 3.712 1.157-1.157a2.625 2.625 0 0 0 0-3.712ZM19.513 8.199l-3.712-3.712-8.4 8.4a5.25 5.25 0 0 0-1.32 2.214l-.8 2.685a.75.75 0 0 0 .933.933l2.685-.8a5.25 5.25 0 0 0 2.214-1.32l8.4-8.4Z"}),e("path",{d:"M5.25 5.25a3 3 0 0 0-3 3v10.5a3 3 0 0 0 3 3h10.5a3 3 0 0 0 3-3V13.5a.75.75 0 0 0-1.5 0v5.25a1.5 1.5 0 0 1-1.5 1.5H5.25a1.5 1.5 0 0 1-1.5-1.5V8.25a1.5 1.5 0 0 1 1.5-1.5h5.25a.75.75 0 0 0 0-1.5H5.25Z"})])}function X(n,m){return o(),c("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M16.5 4.478v.227a48.816 48.816 0 0 1 3.878.512.75.75 0 1 1-.256 1.478l-.209-.035-1.005 13.07a3 3 0 0 1-2.991 2.77H8.084a3 3 0 0 1-2.991-2.77L4.087 6.66l-.209.035a.75.75 0 0 1-.256-1.478A48.567 48.567 0 0 1 7.5 4.705v-.227c0-1.564 1.213-2.9 2.816-2.951a52.662 52.662 0 0 1 3.369 0c1.603.051 2.815 1.387 2.815 2.951Zm-6.136-1.452a51.196 51.196 0 0 1 3.273 0C14.39 3.05 15 3.684 15 4.478v.113a49.488 49.488 0 0 0-6 0v-.113c0-.794.609-1.428 1.364-1.452Zm-.355 5.945a.75.75 0 1 0-1.5.058l.347 9a.75.75 0 1 0 1.499-.058l-.346-9Zm5.48.058a.75.75 0 1 0-1.498-.058l-.347 9a.75.75 0 0 0 1.5.058l.345-9Z","clip-rule":"evenodd"})])}function ee(n,m){return o(),c("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M14 8a.75.75 0 0 1-.75.75H4.56l3.22 3.22a.75.75 0 1 1-1.06 1.06l-4.5-4.5a.75.75 0 0 1 0-1.06l4.5-4.5a.75.75 0 0 1 1.06 1.06L4.56 7.25h8.69A.75.75 0 0 1 14 8Z","clip-rule":"evenodd"})])}function te(n,m){return o(),c("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M2 8a.75.75 0 0 1 .75-.75h8.69L8.22 4.03a.75.75 0 0 1 1.06-1.06l4.5 4.5a.75.75 0 0 1 0 1.06l-4.5 4.5a.75.75 0 0 1-1.06-1.06l3.22-3.22H2.75A.75.75 0 0 1 2 8Z","clip-rule":"evenodd"})])}const ae=()=>{const n=x([]),m=x(""),i=x(""),f=x(""),k=x(1),C=10,w=x(1),P=x(0),g=x(0),p=x(0),d=new Intl.DateTimeFormat(navigator.language,{weekday:"long"}),v=new Intl.DateTimeFormat(navigator.language,{month:"long"}),M=async(l=1)=>{w.value=l;try{const a=await E.get(`/movements/day?startDate=${i.value}&endDate=${f.value}&page=${w.value}&pageSize=${C}`),{dias:t}=a.data;n.value=t.map(r=>{const _=new Date(r.fecha_server);r.dia=_.getDate(),r.nombreDia=d.format(_),r.mes=v.format(_);const{ingresos:D,gastos:G}=r.detalles.reduce((S,N)=>(N.type==="ingreso"?S.ingresos+=Number(N.amount):S.gastos+=Number(N.amount),S),{ingresos:0,gastos:0});return r.ingresos=D,r.gastos=G,r}),P.value=a.data.totalGasto,g.value=a.data.totalIngreso,p.value=a.data.balance,k.value=a.data.totalPages}catch(a){console.error("Error al cargar movimientos",a),y.fire({title:"Ocurrió un error "+a.status,text:a.response.data.error,icon:"error",theme:"auto",timer:3500,showConfirmButton:!1,timerProgressBar:!0,toast:!0,position:"top"})}},B=async l=>{if(!(await y.fire({title:"Eliminar Movimiento?",icon:"question",showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar",theme:"auto"})).isConfirmed){y.fire({title:"No se eliminó!",icon:"info",timer:2e3,theme:"auto",toast:!0,position:"top",showConfirmButton:!1,timerProgressBar:!0});return}y.fire({title:"Eliminando...",allowOutsideClick:!1,didOpen:()=>{y.showLoading()},theme:"auto"});try{await E.delete(`/movements/${l}`),n.value=n.value.filter(t=>t.id!==l);for(const t of n.value){const r=t.detalles.findIndex(_=>_.id===l);if(r!==-1){t.detalles.splice(r,1);break}}y.fire({title:"Movimiento Eliminado",icon:"success",toast:!0,position:"top",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,theme:"auto"})}catch(t){console.error("Error al eliminar movimiento",t),y.fire({title:"Error al eliminar movimiento",icon:"error",toast:!0,position:"top",timer:3e3,showConfirmButton:!1,timerProgressBar:!0,theme:"auto"})}},b=function(){const l=new Date,a=l.getFullYear(),t=String(l.getMonth()+1).padStart(2,"0");i.value=`${a}-${t}-01`,f.value=new Date(a,t,0).toISOString().split("T")[0],m.value=`${a}-${t}`};return F(m,l=>{const[a,t]=l.split("-");i.value=`${a}-${t}-01 00:00:00`,f.value=new Date(a,t,0).toISOString().split("T")[0]+" 23:59:59",M()}),H(()=>b()),{movements:n,fetchMovements:M,selectedMonth:m,deleteMovement:B,currentPage:w,totalPages:k,fetchMovements:M,totalGasto:P,totalIngreso:g,balance:p}},re={class:"flex items-center justify-between mt-6"},se=["disabled"],oe={class:"flex items-center space-x-2"},ne=["onClick"],ie=["disabled"],le={__name:"Pagination",props:{currentPage:{type:Number,required:!0},totalPages:{type:Number,required:!0},maxVisiblePages:{type:Number,default:5}},emits:["page-changed"],setup(n,{emit:m}){const i=n,f=m,k=L(()=>{const g=i.currentPage-(i.currentPage-1)%i.maxVisiblePages,p=Math.min(g+i.maxVisiblePages-1,i.totalPages),d=[];for(let v=g;v<=p;v++)d.push(v);return d});function C(){i.currentPage>1&&f("page-changed",i.currentPage-1)}function w(){i.currentPage<i.totalPages&&f("page-changed",i.currentPage+1)}function P(g){g!==i.currentPage&&f("page-changed",g)}return(g,p)=>(o(),c("div",re,[e("button",{onClick:C,disabled:n.currentPage===1,class:"cursor-pointer p-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[h(s(ee),{class:"w-5"})],8,se),e("div",oe,[(o(!0),c($,null,V(k.value,d=>(o(),c("button",{key:d,onClick:v=>P(d),class:O({"px-4 py-2 text-sm font-medium rounded-md cursor-pointer":!0,"bg-blue-600 text-white":n.currentPage===d,"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50":n.currentPage!==d})},u(d),11,ne))),128))]),e("button",{onClick:w,disabled:n.currentPage===n.totalPages,class:"cursor-pointer p-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[h(s(te),{class:"w-5"})],8,ie)]))}},ce={class:"container mx-auto max-w-3xl"},de={class:"mb-6 flex items-center gap-4"},ue={class:"flex gap-4 justify-between mb-6 p-4 dark:bg-gray-800 bg-blue-50 rounded-lg"},ge={class:"dark:text-green-400 dark:text-green-400 text-green-600 font-bold flex gap-1"},me={class:"dark:text-red-400 dark:text-red-400 text-red-600 font-bold flex gap-1"},he={class:"font-bold dark:text-indigo-200 text-indigo-700 flex gap-1"},fe={key:0,class:"text-center py-8 text-gray-500"},xe={key:1},pe={class:"flex flex-col gap-1 justify-between items-end p-3 dark:bg-gray-800 bg-gray-100 rounded-t-lg"},ve={class:"text-sm text-gray-800 dark:text-gray-200"},be={class:"flex gap-4"},_e={key:0,class:"dark:text-green-400 text-green-600 text-xs sm:text-base"},we={key:1,class:"dark:text-red-400 text-red-600 text-xs sm:text-base"},ye={class:"border border-gray-200 dark:border-gray-700 rounded-b-lg divide-y divide-gray-200 dark:divide-gray-700"},ke={class:"flex justify-between items-start"},Pe={class:"font-medium flex items-center gap-2 dark:text-gray-200"},Ce={class:"text-sm text-gray-500 mt-1 ml-8"},Me={class:"flex flex-col gap-2"},$e={class:"flex gap-2 justify-center items-center"},Be=["onClick"],De=["onClick"],Ze={__name:"Movements",setup(n){const m=U(),i=Y(),f=x({}),k=l=>{f.value=l,m.showModal=!0},{deleteMovement:C,currentPage:w,totalPages:P,fetchMovements:g,selectedMonth:p,movements:d,totalGasto:v,totalIngreso:M,balance:B}=ae();F(()=>i.isSaved,async l=>{l&&await g()});const b=l=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}).format(l);return(l,a)=>(o(),c($,null,[e("div",ce,[e("div",de,[a[1]||(a[1]=e("label",{for:"month-selector",class:"font-medium text-gray-700"},"Mes:",-1)),h(R,{type:"month",modelValue:s(p),"onUpdate:modelValue":a[0]||(a[0]=t=>q(p)?p.value=t:null),id:"month-selector"},null,8,["modelValue"])]),e("div",ue,[e("div",ge,[h(s(T),{class:"w-6"}),e("span",null,"Ingresos: "+u(b(s(M))),1)]),e("div",me,[h(s(j),{class:"w-6"}),e("span",null,"Gastos: "+u(b(s(v))),1)]),e("div",he,[h(s(J),{class:"w-6"}),e("span",null,"Saldo: "+u(b(s(B))),1)])]),s(d).length===0?(o(),c("div",fe," No hay movimientos para este período ")):(o(),c("div",xe,[(o(!0),c($,null,V(s(d),t=>(o(),c("div",{key:t.fecha,class:"mb-8"},[e("div",pe,[e("h2",ve,u(t.nombreDia)+", "+u(t.dia)+" de "+u(t.mes),1),e("div",be,[t.ingresos>0?(o(),c("span",_e," Ingresos: +"+u(b(t.ingresos)),1)):I("",!0),t.gastos>0?(o(),c("span",we," Gastos: -"+u(b(t.gastos)),1)):I("",!0)])]),e("div",ye,[(o(!0),c($,null,V(t.detalles,r=>{var _;return o(),c("div",{key:r.id,class:"p-3 hover:bg-gray-200 dark:hover:bg-gray-800 transition-colors duration-300"},[e("div",ke,[e("div",null,[e("div",Pe,[r.type==="ingreso"?(o(),Z(s(T),{key:0,class:"w-6 text-green-500"})):(o(),Z(s(j),{key:1,class:"w-6 text-red-500"})),A(" "+u(r.description),1)]),e("div",Ce,u((_=r.Category)==null?void 0:_.name)+" • "+u(r.type),1)]),e("div",Me,[e("span",{class:O(["font-medium whitespace-nowrap",r.type==="ingreso"?"dark:text-green-400 text-green-600":"dark:text-red-400 text-red-600"])},u((r.type==="gasto"?"-":"")+b(r.amount)),3),e("div",$e,[e("button",{onClick:D=>k(r),class:"dark:text-blue-400 text-blue-500 hover:text-blue-700 cursor-pointer",title:"Editar movimiento"},[h(s(W),{class:"h-5 w-5"})],8,Be),e("button",{onClick:D=>s(C)(r.id),class:"dark:text-red-400 text-red-500 hover:text-red-700 ml-2 cursor-pointer",title:"Eliminar movimiento"},[h(s(X),{class:"h-5 w-5"})],8,De)])])])])}),128))])]))),128))])),h(le,{currentPage:s(w),totalPages:s(P),onPageChanged:s(g)},null,8,["currentPage","totalPages","onPageChanged"])]),h(K,null,{default:z(()=>[h(Q,{isEdit:"true",data:f.value},null,8,["data"])]),_:1})],64))}};export{Ze as default};
