import{c as g,a as l,o as p,I as x,r as c,w as b,p as R,d as i,j as v,l as w,b as h,J as V,K as k,T as N,L as I,g as C,G as O,n as G,M as Z,N as _,t as M,O as $,F as L,k as P,i as U}from"./index-ytOTDY5P.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{S as y,_ as S,a as B}from"./BaseInput-B-1BT49V.js";import{u as D}from"./categoriesStore-COYFAbW_.js";function ge(t,r){return p(),g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[l("path",{"fill-rule":"evenodd",d:"M1.72 5.47a.75.75 0 0 1 1.06 0L9 11.69l3.756-3.756a.75.75 0 0 1 .985-.066 12.698 12.698 0 0 1 4.575 6.832l.308 1.149 2.277-3.943a.75.75 0 1 1 1.299.75l-3.182 5.51a.75.75 0 0 1-1.025.275l-5.511-3.181a.75.75 0 0 1 .75-1.3l3.943 2.277-.308-1.149a11.194 11.194 0 0 0-3.528-5.617l-3.809 3.81a.75.75 0 0 1-1.06 0L1.72 6.53a.75.75 0 0 1 0-1.061Z","clip-rule":"evenodd"})])}function pe(t,r){return p(),g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[l("path",{"fill-rule":"evenodd",d:"M15.22 6.268a.75.75 0 0 1 .968-.431l5.942 2.28a.75.75 0 0 1 .431.97l-2.28 5.94a.75.75 0 1 1-1.4-.537l1.63-4.251-1.086.484a11.2 11.2 0 0 0-5.45 5.173.75.75 0 0 1-1.199.19L9 12.312l-6.22 6.22a.75.75 0 0 1-1.06-1.061l6.75-6.75a.75.75 0 0 1 1.06 0l3.606 3.606a12.695 12.695 0 0 1 5.68-4.974l1.086-.483-4.251-1.632a.75.75 0 0 1-.432-.97Z","clip-rule":"evenodd"})])}function ve(t,r){return p(),g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[l("path",{d:"M10.464 8.746c.227-.18.497-.311.786-.394v2.795a2.252 2.252 0 0 1-.786-.393c-.394-.313-.546-.681-.546-1.004 0-.323.152-.691.546-1.004ZM12.75 15.662v-2.824c.347.085.664.228.921.421.427.32.579.686.579.991 0 .305-.152.671-.579.991a2.534 2.534 0 0 1-.921.42Z"}),l("path",{"fill-rule":"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v.816a3.836 3.836 0 0 0-1.72.756c-.712.566-1.112 1.35-1.112 2.178 0 .829.4 1.612 1.113 2.178.502.4 1.102.647 1.719.756v2.978a2.536 2.536 0 0 1-.921-.421l-.879-.66a.75.75 0 0 0-.9 1.2l.879.66c.533.4 1.169.645 1.821.75V18a.75.75 0 0 0 1.5 0v-.81a4.124 4.124 0 0 0 1.821-.749c.745-.559 1.179-1.344 1.179-2.191 0-.847-.434-1.632-1.179-2.191a4.122 4.122 0 0 0-1.821-.75V8.354c.29.082.559.213.786.393l.415.33a.75.75 0 0 0 .933-1.175l-.415-.33a3.836 3.836 0 0 0-1.719-.755V6Z","clip-rule":"evenodd"})])}const E=x("modal",()=>{const t=c(!1),r=c(!1);return b(r,a=>{a&&setTimeout(()=>t.value=!0,150)}),b(t,a=>{a||setTimeout(()=>r.value=!1,300)}),{isRendered:t,showModal:r}}),A={class:"bg-slate-100 dark:bg-gray-900 p-4 rounded-lg shadow-xl w-90"},H={__name:"Modal",setup(t){const r=E(),a=()=>r.isRendered=!1;return(u,d)=>i(r).showModal?(p(),g("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30",onClick:I(a,["self"])},[v(N,{name:"slide-down"},{default:w(()=>[h(l("div",A,[k(u.$slots,"default",{},void 0,!0)],512),[[V,i(r).isRendered]])]),_:3})])):R("",!0)}},ye=q(H,[["__scopeId","data-v-fae993be"]]),F=x("balance",()=>{const t=c(""),r=c(""),a=c({totalIngreso:0,totalGasto:0,balance:0}),d=c(function(){const s=new Date,e=s.getFullYear(),o=String(s.getMonth()+1).padStart(2,"0");return t.value=`${e}-${o}-01 00:00:00`,r.value=new Date(e,o,0).toISOString().split("T")[0]+" 23:59:59",`${e}-${o}`}());b(d,s=>{const[e,o]=s.split("-");t.value=`${e}-${o}-01 00:00:00`,r.value=new Date(e,o,0).toISOString().split("T")[0]+" 23:59:59"}),b([t,r],async()=>await m());const n=s=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}).format(s),m=async()=>{try{const s=await C.get(`/movements/balance?startDate=${t.value}&endDate=${r.value}`);a.value=s.data}catch(s){console.error("Error al obtener el balance:",s),y.fire({title:"Error al obtener balance",icon:"error",toast:!0,position:"top",timer:3e3,showConfirmButton:!1,timerProgressBar:!0})}};return{selectedMonth:d,formatCurrency:n,startDate:t,endDate:r,balance:a,fetchBalance:m}}),K=x("graph",()=>{const t=F(),r=c({labels:[],datasets:[{label:"total",data:[],backgroundColor:["#60a5fa","#f87171","#34d399","#fbbf24","#a78bfa","#fb7185","#facc15","#38bdf8"]}]}),a=c({labels:[],datasets:[{label:"total",data:[],backgroundColor:["#60a5fa","#f87171","#34d399","#fbbf24","#a78bfa","#fb7185","#facc15","#38bdf8"]}]}),u=c(0),d=c(1),n=async()=>{const m=t.startDate,s=t.endDate;try{const e=await C.get(`/stats/totalByCategory?startDate=${m}&endDate=${s}`),{data:o}=e;a.value.labels=o.totalGastoByCategory.map(f=>f.Category.name),a.value.datasets[0].data=o.totalGastoByCategory.map(f=>Number(f.total)),r.value.labels=o.totalIngresoByCategory.map(f=>f.Category.name),r.value.datasets[0].data=o.totalIngresoByCategory.map(f=>Number(f.total)),u.value+=1,d.value+=1}catch(e){console.error("Error al cargar datos del gráfico:",e)}};return b(()=>[t.startDate,t.endDate],()=>n()),{chartDataIngreso:r,chartDataGasto:a,getTotalByCategory:n,chartKeyA:u,chartKeyB:d}}),j=x("movement",()=>{const t=F(),r=K(),a=c(!1),u=c({});return{saveMovement:async(n,m)=>{try{m?await C.put(`/movements/${n.id}`,n):await C.post("/movements",n),t.fetchBalance(),r.getTotalByCategory(t.startDate,t.endDate),a.value=!0,u.value=n}catch(s){a.value=!1,console.error("Error al registrar movimiento",s)}},isSaved:a,mov:u}}),z=()=>{const t=j(),r=E(),a=c({type:"ingreso",amount:"",description:"",CategoryId:""}),u=async s=>{if(a.value.amount=n.value.replace(/\D/g,""),s&&!(await y.fire({title:"¿Desea Editar Registro?",icon:"question",showCancelButton:!0,confirmButtonText:"Sí, Editar",cancelButtonText:"Cancelar",theme:"auto"})).isConfirmed){r.showModal=!1,d(),y.fire({title:"Edicion Cancelada",icon:"success",toast:!0,position:"top",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,theme:"auto"});return}y.fire({title:s?"Editando":"Guardando...",allowOutsideClick:!1,didOpen:()=>{y.showLoading()},theme:"auto"}),await t.saveMovement(a.value,s),y.close(),r.isRendered=!1,t.isSaved?y.fire({title:`Movimiento ${s?"Editado":"Registrado"}`,icon:"success",toast:!0,position:"top",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,theme:"auto"}):y.fire({title:`Error al ${s?"Editar":"Registrar"} movimiento`,icon:"error",toast:!0,position:"top",timer:3e3,showConfirmButton:!1,timerProgressBar:!0,theme:"auto"}),r.showModal=!1,d()},d=()=>{a.value={type:"ingreso",amount:"",description:"",categoryId:"",id:""},t.isSaved=!1},n=c("");function m(s,e=!0){let o=s;if(e&&(o=s.target.value.replace(/\D/g,"")),o===""){n.value="";return}const f=parseInt(o,10);if(isNaN(f)){n.value="";return}const T=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0});n.value=T.format(f)}return{movement:a,submitForm:u,formatearComoMoneda:m,valor:n,modalStore:r}},Y=["id","value","placeholder","disabled"],J="w-full dark:text-gray-200 text-gray-600 px-3 py-2 border-2 dark:border-gray-700 rounded-sm focus:outline-none transition duration-300 focus:ring-2",Q={__name:"BaseSelect",props:{modelValue:{required:!0},placeholder:String,id:String,color:{type:String,default:"primary"},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(t,{emit:r}){const a=t,u={primary:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500",danger:"border-red-300 focus:border-red-500 focus:ring-red-500"},d=O(()=>u[a.color]??u.primary);return(n,m)=>(p(),g("select",{id:t.id,value:t.modelValue,placeholder:t.placeholder,disabled:t.disabled,class:G([J,d.value,t.disabled?"opacity-50 cursor-not-allowed":""]),onInput:m[0]||(m[0]=s=>n.$emit("update:modelValue",s.target.value))},[k(n.$slots,"default")],42,Y))}};function W(t,r){return p(),g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[l("path",{"fill-rule":"evenodd",d:"M10.47 2.22a.75.75 0 0 1 1.06 0l2.25 2.25a.75.75 0 0 1 0 1.06l-2.25 2.25a.75.75 0 1 1-1.06-1.06l.97-.97H5.75a.75.75 0 0 1 0-1.5h5.69l-.97-.97a.75.75 0 0 1 0-1.06Zm-4.94 6a.75.75 0 0 1 0 1.06l-.97.97h5.69a.75.75 0 0 1 0 1.5H4.56l.97.97a.75.75 0 1 1-1.06 1.06l-2.25-2.25a.75.75 0 0 1 0-1.06l2.25-2.25a.75.75 0 0 1 1.06 0Z","clip-rule":"evenodd"})])}const X={class:"mx-auto p-4 border border-gray-300 rounded-lg shadow-lg bg-slate-100 dark:bg-gray-900 dark:text-gray-100 dark:border-gray-700"},ee={class:"text-2xl font-semibold mb-4"},te={class:"flex flex-col w-full"},ae={class:"w-full flex gap-4"},oe={class:"inline-flex items-center gap-2 cursor-pointer"},re={class:"inline-flex items-center gap-2 cursor-pointer"},se={class:"w-full"},le=["value"],ne={class:"w-full"},ie={class:"w-full"},de={class:"flex gap-2"},be={__name:"MovementForm",props:Z(["isEdit","data"],{isEdit:!1}),setup(t){const{formatearComoMoneda:r,movement:a,submitForm:u,valor:d,modalStore:n}=z(),m=D();return _(async()=>{if(t.isEdit&&t.data){const s=new Date(t.data.date),e=f=>f.toString().padStart(2,"0"),o=`${s.getFullYear()}-${e(s.getMonth()+1)}-${e(s.getDate())}T${e(s.getHours())}:${e(s.getMinutes())}`;a.value={...t.data,date:o},r(t.data.amount,!1),await D().getCategories()}}),(s,e)=>(p(),g("div",X,[l("h2",ee,M(t.isEdit?"Editar":"Registrar")+" Movimiento",1),l("form",{onSubmit:e[7]||(e[7]=I(o=>i(u)(t.isEdit),["prevent"])),class:"flex flex-col gap-4 items-end",autocomplete:"off"},[h(l("div",te,[e[8]||(e[8]=l("label",{for:"createdAt"},"Fecha",-1)),v(S,{id:"createdAt",type:"datetime-local",modelValue:i(a).date,"onUpdate:modelValue":e[0]||(e[0]=o=>i(a).date=o)},null,8,["modelValue"])],512),[[V,t.isEdit]]),l("div",ae,[l("label",oe,[h(l("input",{id:"ingreso",type:"radio",value:"ingreso","onUpdate:modelValue":e[1]||(e[1]=o=>i(a).type=o),class:"form-radio h-5 w-5"},null,512),[[$,i(a).type]]),e[9]||(e[9]=l("span",null,"Ingreso",-1))]),l("label",re,[h(l("input",{id:"gasto",type:"radio",value:"gasto","onUpdate:modelValue":e[2]||(e[2]=o=>i(a).type=o),class:"form-radio h-5 w-5"},null,512),[[$,i(a).type]]),e[10]||(e[10]=l("span",null,"Gasto",-1))])]),l("div",se,[e[12]||(e[12]=l("label",{for:"category",class:"block text-gray-700 dark:text-gray-300"},"Categoría",-1)),v(Q,{id:"category",modelValue:i(a).CategoryId,"onUpdate:modelValue":e[3]||(e[3]=o=>i(a).CategoryId=o)},{default:w(()=>[e[11]||(e[11]=l("option",{value:"",disabled:""},"Selecciona una categoría",-1)),(p(!0),g(L,null,P(i(m).categories,o=>(p(),g("option",{key:o.id,value:o.id},M(o.name),9,le))),128))]),_:1},8,["modelValue"])]),l("div",ne,[e[13]||(e[13]=l("label",{for:"amount",class:"block text-gray-700 dark:text-gray-300"},"Monto",-1)),v(S,{type:"tel",id:"amount",modelValue:i(d),"onUpdate:modelValue":e[4]||(e[4]=o=>U(d)?d.value=o:null),required:"",onInput:i(r)},null,8,["modelValue","onInput"])]),l("div",ie,[e[14]||(e[14]=l("label",{for:"description",class:"block text-gray-700 dark:text-gray-300"},"Descripción",-1)),v(S,{id:"description",modelValue:i(a).description,"onUpdate:modelValue":e[5]||(e[5]=o=>i(a).description=o),modelModifiers:{trim:!0}},null,8,["modelValue"])]),l("div",de,[v(B,{type:"submit",class:"flex gap-2 items-center"},{default:w(()=>[l("span",null,M(t.isEdit?"Editar":"Crear")+" Movimiento",1),v(i(W),{class:"w-5 inline"})]),_:1}),v(B,{color:"danger",onClick:e[6]||(e[6]=o=>i(n).isRendered=!1)},{default:w(()=>e[15]||(e[15]=[l("span",null,"Cerrar",-1)])),_:1})])],32)]))}};export{ye as M,be as _,F as a,ge as b,ve as c,K as d,j as e,pe as r,E as u};
