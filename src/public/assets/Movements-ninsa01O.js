import{c,o as d,a as e,r as f,w as F,f as T,g as O,G as V,j as _,d as l,F as S,k as I,n as j,t as a,i as G,l as L,H as z}from"./index-Cb_ptunQ.js";import{S as P,_ as A}from"./BaseInput-DB7JiPpI.js";import{u as q,M as H,_ as J}from"./MovementForm-DbVmAIrd.js";import{r as R,a as Z}from"./TrashIcon-DfnvZlCO.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./categoriesStore-DO-8lnFM.js";function U(i,p){return d(),c("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M14 8a.75.75 0 0 1-.75.75H4.56l3.22 3.22a.75.75 0 1 1-1.06 1.06l-4.5-4.5a.75.75 0 0 1 0-1.06l4.5-4.5a.75.75 0 0 1 1.06 1.06L4.56 7.25h8.69A.75.75 0 0 1 14 8Z","clip-rule":"evenodd"})])}function Y(i,p){return d(),c("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M2 8a.75.75 0 0 1 .75-.75h8.69L8.22 4.03a.75.75 0 0 1 1.06-1.06l4.5 4.5a.75.75 0 0 1 0 1.06l-4.5 4.5a.75.75 0 0 1-1.06-1.06l3.22-3.22H2.75A.75.75 0 0 1 2 8Z","clip-rule":"evenodd"})])}const K=()=>{const i=f([]),p=f(""),o=f(""),b=f(""),k=f(1),C=10,w=f(1),M=f(0),n=f(0),x=f(0),u=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],y=["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],$=async(h=1)=>{w.value=h;try{const t=await O.get(`/movements/day?startDate=${o.value}&endDate=${b.value}&page=${w.value}&pageSize=${C}`),{dias:s}=t.data;i.value=s.map(g=>{const r=new Date(g.fecha);g.dia=r.getDate(),g.nombreDia=y[r.getDay()],g.mes=u[r.getMonth()];const{ingresos:m,gastos:D}=g.detalles.reduce((B,N)=>(N.type==="ingreso"?B.ingresos+=Number(N.amount):B.gastos+=Number(N.amount),B),{ingresos:0,gastos:0});return g.ingresos=m,g.gastos=D,g}),M.value=t.data.totalGasto,n.value=t.data.totalIngreso,x.value=t.data.balance,k.value=t.data.totalPages}catch(t){console.error("Error al cargar movimientos",t),P.fire({title:"Ocurrió un error "+t.status,text:t.response.data.error,icon:"error",theme:"auto",timer:3500,showConfirmButton:!1,timerProgressBar:!0,toast:!0,position:"top"})}},E=async h=>{if(!(await P.fire({title:"Eliminar Movimiento?",icon:"question",showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar",theme:"auto"})).isConfirmed){P.fire({title:"No se eliminó!",icon:"info",timer:2e3,theme:"auto",toast:!0,position:"top",showConfirmButton:!1,timerProgressBar:!0});return}P.fire({title:"Eliminando...",allowOutsideClick:!1,didOpen:()=>{P.showLoading()},theme:"auto"});try{await O.delete(`/movements/${h}`),i.value=i.value.filter(s=>s.id!==h),P.fire({title:"Movimiento Eliminado",icon:"success",toast:!0,position:"top",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,theme:"auto"})}catch(s){console.error("Error al eliminar movimiento",s),P.fire({title:"Error al eliminar movimiento",icon:"error",toast:!0,position:"top",timer:3e3,showConfirmButton:!1,timerProgressBar:!0,theme:"auto"})}},v=function(){const h=new Date,t=h.getFullYear(),s=String(h.getMonth()+1).padStart(2,"0");o.value=`${t}-${s}-01`,b.value=new Date(t,s,0).toISOString().split("T")[0],p.value=`${t}-${s}`};return F(p,h=>{const[t,s]=h.split("-");o.value=`${t}-${s}-01 00:00:00`,b.value=new Date(t,s,0).toISOString().split("T")[0]+" 23:59:59",$()}),T(()=>v()),{movements:i,fetchMovements:$,selectedMonth:p,deleteMovement:E,currentPage:w,totalPages:k,fetchMovements:$,totalGasto:M,totalIngreso:n,balance:x,meses:u}},Q={class:"flex items-center justify-between mt-6"},W=["disabled"],X={class:"flex items-center space-x-2"},ee=["onClick"],te=["disabled"],se={__name:"Pagination",props:{currentPage:{type:Number,required:!0},totalPages:{type:Number,required:!0},maxVisiblePages:{type:Number,default:5}},emits:["page-changed"],setup(i,{emit:p}){const o=i,b=p,k=V(()=>{const n=o.currentPage-(o.currentPage-1)%o.maxVisiblePages,x=Math.min(n+o.maxVisiblePages-1,o.totalPages),u=[];for(let y=n;y<=x;y++)u.push(y);return u});function C(){o.currentPage>1&&b("page-changed",o.currentPage-1)}function w(){o.currentPage<o.totalPages&&b("page-changed",o.currentPage+1)}function M(n){n!==o.currentPage&&b("page-changed",n)}return(n,x)=>(d(),c("div",Q,[e("button",{onClick:C,disabled:i.currentPage===1,class:"cursor-pointer p-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[_(l(U),{class:"w-5"})],8,W),e("div",X,[(d(!0),c(S,null,I(k.value,u=>(d(),c("button",{key:u,onClick:y=>M(u),class:j({"px-4 py-2 text-sm font-medium rounded-md cursor-pointer":!0,"bg-blue-600 text-white":i.currentPage===u,"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50":i.currentPage!==u})},a(u),11,ee))),128))]),e("button",{onClick:w,disabled:i.currentPage===i.totalPages,class:"cursor-pointer p-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[_(l(Y),{class:"w-5"})],8,te)]))}},oe={class:"container mx-auto max-w-3xl"},re={class:"mb-6 flex items-center gap-4"},ae={class:"flex flex-col justify-between items-center mb-6 p-4 dark:bg-gray-800 bg-blue-50 rounded-lg"},ne={class:"text-2xl font-bold text-blue-800 dark:text-gray-200"},ie={class:"flex gap-4"},le={class:"text-green-600 font-bold"},ce={class:"text-red-600 font-bold"},de={class:"font-bold dark:text-gray-200"},ue={key:0,class:"text-center py-8 text-gray-500"},ge={key:1},me={class:"flex gap-4 justify-between items-center p-3 dark:bg-gray-800 bg-gray-100 rounded-t-lg"},he={class:"text-gray-800 dark:text-gray-200"},fe={key:0,class:"text-green-600 font-medium"},pe={key:1,class:"text-red-600 font-medium"},be={class:"dark:text-gray-200"},ve={class:"border border-gray-200 dark:border-gray-700 rounded-b-lg divide-y divide-gray-200 dark:divide-gray-700"},xe={class:"flex justify-between items-start"},ye={class:"font-medium flex items-center gap-2 dark:text-gray-200"},_e={class:"text-sm text-gray-500 mt-1 ml-8"},we={class:"flex flex-col gap-2"},Pe={class:"flex gap-2 justify-center items-center"},ke=["onClick"],Me=["onClick"],Ne={__name:"Movements",setup(i){const p=q(),o=f({}),b=s=>{o.value=s,p.showModal=!0},{deleteMovement:k,currentPage:C,totalPages:w,fetchMovements:M,selectedMonth:n,movements:x,totalGasto:u,totalIngreso:y,balance:$,meses:E}=K(),v=s=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}).format(s),h=V(()=>{const s=parseInt(n.value.split("-")[1])-1;return E[s]}),t=V(()=>n.value.split("-")[0]);return(s,g)=>(d(),c(S,null,[e("div",oe,[e("div",re,[g[1]||(g[1]=e("label",{for:"month-selector",class:"font-medium text-gray-700"},"Mes:",-1)),_(A,{type:"month",modelValue:l(n),"onUpdate:modelValue":g[0]||(g[0]=r=>G(n)?n.value=r:null),id:"month-selector"},null,8,["modelValue"])]),e("div",ae,[e("h1",ne," Resumen de "+a(h.value)+" "+a(t.value),1),e("div",ie,[e("div",le," Ingresos: "+a(v(l(y))),1),e("div",ce," Gastos: "+a(v(l(u))),1),e("div",de," Balance: "+a(v(l($))),1)])]),l(x).length===0?(d(),c("div",ue," No hay movimientos para este período ")):(d(),c("div",ge,[(d(!0),c(S,null,I(l(x),r=>(d(),c("div",{key:r.fecha,class:"mb-8"},[e("div",me,[e("h2",he,a(r.nombreDia)+", "+a(r.dia)+" de "+a(r.mes),1),r.ingresos>r.gastos?(d(),c("span",fe," +"+a(v(r.ingresos)),1)):(d(),c("span",pe," -"+a(v(r.gastos)),1)),e("span",be," Saldo: "+a(v(r.ingresos-r.gastos)),1)]),e("div",ve,[(d(!0),c(S,null,I(r.detalles,m=>{var D;return d(),c("div",{key:m.id,class:"p-3 hover:bg-gray-200 dark:hover:bg-gray-800 transition-colors duration-300"},[e("div",xe,[e("div",null,[e("div",ye,[e("span",{class:j(["w-6 h-6 rounded-full flex items-center justify-center",m.type==="ingreso"?"bg-green-100 text-green-600":"bg-red-100 text-red-600"])},a(m.type==="ingreso"?"↑":"↓"),3),z(" "+a(m.description),1)]),e("div",_e,a((D=m.Category)==null?void 0:D.name)+" • "+a(m.type),1)]),e("div",we,[e("span",{class:j(["font-medium whitespace-nowrap",m.type==="ingreso"?"text-green-600":"text-red-600"])},a((m.type==="gasto"?"-":"")+v(m.amount)),3),e("div",Pe,[e("button",{onClick:B=>b(m),class:"text-blue-500 hover:text-blue-700 cursor-pointer",title:"Editar movimiento"},[_(l(R),{class:"h-5 w-5"})],8,ke),e("button",{onClick:B=>l(k)(m.id),class:"text-red-500 hover:text-red-700 ml-2 cursor-pointer",title:"Eliminar movimiento"},[_(l(Z),{class:"h-5 w-5"})],8,Me)])])])])}),128))])]))),128))])),_(se,{currentPage:l(C),totalPages:l(w),onPageChanged:l(M)},null,8,["currentPage","totalPages","onPageChanged"])]),_(H,null,{default:L(()=>[_(J,{isEdit:"true",data:o.value},null,8,["data"])]),_:1})],64))}};export{Ne as default};
