import{c as n,o as r,a as e,y as oe,b as c,u as s,F as X,r as O,n as Z,t as u,j as ee,l as re,h as p,m as te,p as ne,A as le,i as ie,k as N,w as H,T as de,q as S,C as ce,g as ue,D as R,E as ge,G as me,H as fe,d as q,v as U,z as B}from"./index-BIQqEOZA.js";import{I as ve}from"./iconify-Cw4JIRDF.js";import{u as pe,C as xe}from"./movementStore-Bc2uukLE.js";import{_ as J}from"./BaseButton-C-1Q9ZVJ.js";import{_ as he}from"./BaseInput-BAsoIT1y.js";import{u as se}from"./useDates-B6TuTcoJ.js";import{g as ye}from"./icons-BjrsL8W4.js";import{_ as be}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as K,a as Q,b as we}from"./CurrencyDollarIcon-C6d_LZAj.js";import{r as _e}from"./ArrowPathIcon-CR2j9uG6.js";import"./categoriesStore-C4UhHkgE.js";function ke(l,m){return r(),n("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M3.792 2.938A49.069 49.069 0 0 1 12 2.25c2.797 0 5.54.236 8.209.688a1.857 1.857 0 0 1 1.541 1.836v1.044a3 3 0 0 1-.879 2.121l-6.182 6.182a1.5 1.5 0 0 0-.439 1.061v2.927a3 3 0 0 1-1.658 2.684l-1.757.878A.75.75 0 0 1 9.75 21v-5.818a1.5 1.5 0 0 0-.44-1.06L3.13 7.938a3 3 0 0 1-.879-2.121V4.774c0-.897.64-1.683 1.542-1.836Z","clip-rule":"evenodd"})])}function W(l,m){return r(),n("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{d:"M21.731 2.269a2.625 2.625 0 0 0-3.712 0l-1.157 1.157 3.712 3.712 1.157-1.157a2.625 2.625 0 0 0 0-3.712ZM19.513 8.199l-3.712-3.712-8.4 8.4a5.25 5.25 0 0 0-1.32 2.214l-.8 2.685a.75.75 0 0 0 .933.933l2.685-.8a5.25 5.25 0 0 0 2.214-1.32l8.4-8.4Z"}),e("path",{d:"M5.25 5.25a3 3 0 0 0-3 3v10.5a3 3 0 0 0 3 3h10.5a3 3 0 0 0 3-3V13.5a.75.75 0 0 0-1.5 0v5.25a1.5 1.5 0 0 1-1.5 1.5H5.25a1.5 1.5 0 0 1-1.5-1.5V8.25a1.5 1.5 0 0 1 1.5-1.5h5.25a.75.75 0 0 0 0-1.5H5.25Z"})])}function Y(l,m){return r(),n("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M16.5 4.478v.227a48.816 48.816 0 0 1 3.878.512.75.75 0 1 1-.256 1.478l-.209-.035-1.005 13.07a3 3 0 0 1-2.991 2.77H8.084a3 3 0 0 1-2.991-2.77L4.087 6.66l-.209.035a.75.75 0 0 1-.256-1.478A48.567 48.567 0 0 1 7.5 4.705v-.227c0-1.564 1.213-2.9 2.816-2.951a52.662 52.662 0 0 1 3.369 0c1.603.051 2.815 1.387 2.815 2.951Zm-6.136-1.452a51.196 51.196 0 0 1 3.273 0C14.39 3.05 15 3.684 15 4.478v.113a49.488 49.488 0 0 0-6 0v-.113c0-.794.609-1.428 1.364-1.452Zm-.355 5.945a.75.75 0 1 0-1.5.058l.347 9a.75.75 0 1 0 1.499-.058l-.346-9Zm5.48.058a.75.75 0 1 0-1.498-.058l-.347 9a.75.75 0 0 0 1.5.058l.345-9Z","clip-rule":"evenodd"})])}function Ce(l,m){return r(),n("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M14 8a.75.75 0 0 1-.75.75H4.56l3.22 3.22a.75.75 0 1 1-1.06 1.06l-4.5-4.5a.75.75 0 0 1 0-1.06l4.5-4.5a.75.75 0 0 1 1.06 1.06L4.56 7.25h8.69A.75.75 0 0 1 14 8Z","clip-rule":"evenodd"})])}function Pe(l,m){return r(),n("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M2 8a.75.75 0 0 1 .75-.75h8.69L8.22 4.03a.75.75 0 0 1 1.06-1.06l4.5 4.5a.75.75 0 0 1 0 1.06l-4.5 4.5a.75.75 0 0 1-1.06-1.06l3.22-3.22H2.75A.75.75 0 0 1 2 8Z","clip-rule":"evenodd"})])}const Me={class:"flex items-center justify-between mt-6"},$e=["disabled"],Te={class:"flex items-center space-x-2"},Ve=["onClick"],Se=["disabled"],De={__name:"Pagination",props:{currentPage:{type:Number,required:!0},totalPages:{type:Number,required:!0},maxVisiblePages:{type:Number,default:5}},emits:["page-changed"],setup(l,{emit:m}){const i=l,y=m,_=oe(()=>{const x=i.currentPage-(i.currentPage-1)%i.maxVisiblePages,v=Math.min(x+i.maxVisiblePages-1,i.totalPages),g=[];for(let w=x;w<=v;w++)g.push(w);return g});function D(){i.currentPage>1&&y("page-changed",i.currentPage-1)}function k(){i.currentPage<i.totalPages&&y("page-changed",i.currentPage+1)}function b(x){x!==i.currentPage&&y("page-changed",x)}return(x,v)=>(r(),n("div",Me,[e("button",{onClick:D,disabled:l.currentPage===1,class:"cursor-pointer p-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[c(s(Ce),{class:"w-5"})],8,$e),e("div",Te,[(r(!0),n(X,null,O(_.value,g=>(r(),n("button",{key:g,onClick:w=>b(g),class:Z({"px-4 py-2 text-sm font-medium rounded-md cursor-pointer":!0,"bg-blue-600 text-white":l.currentPage===g,"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50":l.currentPage!==g})},u(g),11,Ve))),128))]),e("button",{onClick:k,disabled:l.currentPage===l.totalPages,class:"cursor-pointer p-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[c(s(Pe),{class:"w-5"})],8,Se)]))}},Ee=l=>{const{getTimezoneOffsetString:m}=se(),i=m();return ee.get(`/movements/day?tz=${i}`,{params:l})},Ie=l=>ee.delete(`/movements/${l}`),Ne=re("movements",()=>{const{showError:l,showConfirm:m,showInfo:i,showLoading:y,showSuccess:_}=ne(),{selectedMonth:D,startDate:k,endDate:b,resetToCurrentMonth:x}=se(),v=p([]),g=p(1),w=10,E=p(1),C=p(0),T=p(0),I=p(0),P=new Intl.DateTimeFormat(navigator.language,{weekday:"long"}),z=new Intl.DateTimeFormat(navigator.language,{month:"long"}),M=p(""),f=p(0),V=p(!1),j=async(d=1)=>{E.value=d,v.value=[],V.value=!0;try{const t=await Ee({startDate:k.value,endDate:b.value,page:E.value,pageSize:w,type:M.value,categoryId:f.value||""}),{dias:o}=t.data;v.value=o.map(a=>{const $=new Date(a.fecha_server);a.dia=$.getDate(),a.nombreDia=P.format($),a.mes=z.format($);const{ingresos:h,gastos:ae}=a.detalles.reduce((F,G)=>(G.type==="ingreso"?F.ingresos+=Number(G.amount):F.gastos+=Number(G.amount),F),{ingresos:0,gastos:0});return a.ingresos=h,a.gastos=ae,a}),C.value=t.data.totalGasto,T.value=t.data.totalIngreso,I.value=t.data.balance,g.value=t.data.totalPages}catch(t){console.error("Error al cargar movimientos",t),l(`Ocurrió un error ${t.status}`,t.response.data.error)}finally{V.value=!1}},L=async d=>{const{isConfirmed:t}=await m("¿Eliminar Movimiento?","Eliminar","Cancelar");if(!t){i("No se eliminó!");return}y("Eliminando...");try{await Ie(d),v.value=v.value.filter(o=>o.id!==d);for(const o of v.value){const a=o.detalles.findIndex($=>$.id===d);if(a!==-1){o.detalles.splice(a,1);break}}_("Movimiento Eliminado")}catch(o){console.error("Error al eliminar movimiento",o),l("Error al eliminar movimiento")}},A=()=>{f.value=0,M.value="",x()};return te([k,b,f,M],()=>j()),{movements:v,fetchMovements:j,selectedMonth:D,deleteMovement:L,currentPage:E,totalPages:g,totalGasto:C,totalIngreso:T,balance:I,selectedType:M,selectedCategory:f,isLoading:V,handleReset:A}}),je={class:"container mx-auto max-w-3xl py-4 px-2"},Be={class:"mb-4 flex justify-end gap-2"},Ze={key:0},ze={key:0,class:"mb-6 grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-lg"},Le={class:"w-full md:col-span-2"},Ae={class:"flex gap-2 justify-between mb-6 p-2 dark:bg-gray-800 bg-blue-50 rounded-lg"},Fe={class:"dark:text-green-400 dark:text-green-400 text-green-600 font-bold flex gap-1"},Ge={class:"dark:text-red-400 dark:text-red-400 text-red-600 font-bold flex gap-1"},He={class:"font-bold dark:text-indigo-200 text-indigo-700 flex gap-1"},Re={key:0,class:"min-h-[200px] flex items-center justify-center rounded-lg"},Xe={key:1,class:"text-center py-8 text-gray-500"},Oe={key:2},qe={class:"flex flex-col gap-1 justify-between items-end p-3 dark:bg-gray-800 bg-gray-100 rounded-t-lg"},Ue={class:"text-sm text-gray-800 dark:text-gray-200"},Je={class:"flex gap-4"},Ke={key:0,class:"dark:text-green-400 text-green-600 text-xs sm:text-base"},Qe={key:1,class:"dark:text-red-400 text-red-600 text-xs sm:text-base"},We={class:"border border-gray-200 dark:border-gray-700 rounded-b-lg divide-y divide-gray-200 dark:divide-gray-700"},Ye=["onTouchmove","onTouchend"],et={class:"w-full p-3 hover:bg-gray-200 dark:hover:bg-gray-800 flex justify-between items-center gap-4 transition-colors duration-300"},tt={class:"flex justify-between items-center w-full"},st={class:"font-medium flex items-center gap-2 dark:text-gray-200"},at={class:"text-sm text-gray-500 mt-1 flex gap-2 items-center"},ot={class:"hidden sm:flex gap-2"},rt=["onClick"],nt=["onClick"],lt={class:"sm:hidden flex w-[154px] shrink-0"},it=["onClick"],dt=["onClick"],ct={__name:"Movements",setup(l){const m=pe(),i=Ne(),{deleteMovement:y,fetchMovements:_,handleReset:D}=i,{movements:k,selectedMonth:b,currentPage:x,totalPages:v,totalGasto:g,totalIngreso:w,balance:E,selectedType:C,selectedCategory:T,isLoading:I}=le(i),P=p(!1),z=ue(),M=d=>{sessionStorage.setItem("data",JSON.stringify(d)),z.push({name:"Movement",query:{isEdit:!0}})};te(()=>m.isSaved,async d=>{d&&await _()}),ie(async()=>await _());const f=p({});let V=0;const j=d=>{V=d.touches[0].clientX},L=(d,t)=>{const a=d.touches[0].clientX-V;a<0&&a>-120&&(f.value[t]=a),a>0&&f.value[t]&&(f.value[t]=a)},A=d=>{const t=f.value[d]||0;f.value[d]=t<-50?-195:0,t>0&&(f.value[d]=0)};return(d,t)=>(r(),n("div",je,[e("div",Be,[P.value?(r(),n("div",Ze,[c(J,{color:"danger",onClick:s(D),class:"flex gap-2 items-center"},{default:H(()=>[c(s(_e),{class:"w-5 h-5"}),t[5]||(t[5]=e("span",null,"Borrar Filtros",-1))]),_:1},8,["onClick"])])):N("",!0),c(J,{class:"flex items-center gap-2",onClick:t[0]||(t[0]=o=>P.value=!P.value)},{default:H(()=>[c(s(ke),{class:"h-4 w-4"}),e("span",null,u(P.value?"Ocultar filtros":"Mostrar filtros"),1)]),_:1})]),c(de,{name:"filter-slide"},{default:H(()=>[P.value?(r(),n("div",ze,[e("div",null,[t[6]||(t[6]=e("label",{for:"month-selector",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Mes:",-1)),c(he,{type:"month",modelValue:s(b),"onUpdate:modelValue":t[1]||(t[1]=o=>R(b)?b.value=o:null),id:"month-selector"},null,8,["modelValue"])]),e("div",null,[t[8]||(t[8]=e("label",{for:"type-filter",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Tipo:",-1)),ge(e("select",{id:"type-filter","onUpdate:modelValue":t[2]||(t[2]=o=>R(C)?C.value=o:null),class:"w-full p-2 border border-gray-300 rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white"},t[7]||(t[7]=[e("option",{value:""},"Todos",-1),e("option",{value:"ingreso"},"Ingresos",-1),e("option",{value:"gasto"},"Gastos",-1)]),512),[[me,s(C)]])]),e("div",Le,[t[9]||(t[9]=e("span",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Categoría:",-1)),c(xe,{id:"category-filter",type:s(C),modelValue:s(T),"onUpdate:modelValue":t[3]||(t[3]=o=>R(T)?T.value=o:null),class:"dark:text-gray-100"},null,8,["type","modelValue"])])])):N("",!0)]),_:1}),e("div",Ae,[e("div",Fe,[c(s(K),{class:"w-6"}),e("span",null,"Ingresos: "+u(s(S)(s(w))),1)]),e("div",Ge,[c(s(Q),{class:"w-6"}),e("span",null,"Gastos: "+u(s(S)(s(g))),1)]),e("div",He,[c(s(we),{class:"w-6"}),e("span",null,"Saldo: "+u(s(S)(s(E))),1)])]),s(I)?(r(),n("div",Re,t[10]||(t[10]=[ce('<div class="text-center" data-v-4f004e6f><svg class="animate-spin h-8 w-8 text-blue-500 mx-auto mb-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" data-v-4f004e6f><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" data-v-4f004e6f></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" data-v-4f004e6f></path></svg><span class="text-gray-600 dark:text-gray-300" data-v-4f004e6f>Cargando movimientos...</span></div>',1)]))):N("",!0),s(k).length===0&&!s(I)?(r(),n("div",Xe," No hay movimientos para este período ")):(r(),n("div",Oe,[(r(!0),n(X,null,O(s(k),o=>(r(),n("div",{key:o.fecha,class:"mb-8"},[e("div",qe,[e("h2",Ue,u(o.nombreDia)+", "+u(o.dia)+" de "+u(o.mes),1),e("div",Je,[o.ingresos>0?(r(),n("span",Ke," Ingresos: +"+u(s(S)(o.ingresos)),1)):N("",!0),o.gastos>0?(r(),n("span",Qe," Gastos: -"+u(s(S)(o.gastos)),1)):N("",!0)])]),e("div",We,[(r(!0),n(X,null,O(o.detalles,(a,$)=>(r(),n("div",{key:a.id,class:"overflow-x-hidden block",onTouchstart:t[4]||(t[4]=h=>j(h)),onTouchmove:h=>L(h,a.id),onTouchend:h=>A(a.id)},[e("div",{class:"flex w-[calc(100%+158px)] sm:w-full transition-transform duration-100",style:fe({transform:`translateX(${f.value[a.id]||0}px)`})},[e("div",et,[e("div",tt,[e("div",null,[e("div",st,[a.type==="ingreso"?(r(),q(s(K),{key:0,class:"w-6 text-green-500"})):(r(),q(s(Q),{key:1,class:"w-6 text-red-500"})),U(" "+u(a.description),1)]),e("div",at,[e("div",{class:Z([[s(ye)(a.Category.icon)],"rounded-full p-1 text-white text-lg"])},[c(s(ve),{icon:a.Category.icon},null,8,["icon"])],2),U(" "+u(a.Category.name)+" • "+u(a.type),1)])]),e("span",{class:Z(["font-medium whitespace-nowrap",a.type==="ingreso"?"dark:text-green-400 text-green-600":"dark:text-red-400 text-red-600"])},u((a.type==="gasto"?"-":"")+s(S)(a.amount)),3)]),e("div",ot,[e("button",{onClick:B(h=>M(a),["stop"]),class:"w-6 flex items-center justify-center text-blue-500 hover:text-blue-600 cursor-pointer",title:"Editar movimiento"},[c(s(W),{class:"h-6 w-6"})],8,rt),e("button",{onClick:B(h=>s(y)(a.id),["stop"]),class:"w-6 flex items-center justify-center text-red-500 hover:text-red-600 cursor-pointer",title:"Eliminar movimiento"},[c(s(Y),{class:"h-6 w-6"})],8,nt)])]),e("div",lt,[e("button",{onClick:B(h=>M(a),["stop"]),class:"w-full flex gap-2 p-2 items-center justify-center text-white bg-blue-500 hover:bg-blue-600"},[c(s(W),{class:"h-5 w-5"}),t[11]||(t[11]=e("span",null,"Editar",-1))],8,it),e("button",{onClick:B(h=>s(y)(a.id),["stop"]),class:Z(["w-full flex gap-2 p-2 items-center justify-center text-white bg-red-500 hover:bg-red-600",[$===o.detalles.length-1?"rounded-br-lg":""]])},[c(s(Y),{class:"h-5 w-5"}),t[12]||(t[12]=e("span",null,"Eliminar",-1))],10,dt)])],4)],40,Ye))),128))])]))),128))])),c(De,{currentPage:s(x),totalPages:s(v),onPageChanged:s(_)},null,8,["currentPage","totalPages","onPageChanged"])]))}},_t=be(ct,[["__scopeId","data-v-4f004e6f"]]);export{_t as default};
