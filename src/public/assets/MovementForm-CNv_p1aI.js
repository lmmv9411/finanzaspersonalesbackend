import{c as g,a as o,o as v,I as M,r as u,x as b,i as L,k as d,f,w as y,J as h,K as S,L as N,T as V,G as R,d as x,l as k,b as O,n as $,t as C,F as U,g as H,M as P,N as j,O as B,H as q}from"./index-BWCHhfKg.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{S as w,_}from"./BaseInput-8PfNurit.js";import{u as F,g as D}from"./icons-DE0v2-l3.js";import{I}from"./iconify-dvdQFbfz.js";import{_ as E}from"./BaseButton-DDK_jik-.js";function $e(t,a){return v(),g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[o("path",{"fill-rule":"evenodd",d:"M1.72 5.47a.75.75 0 0 1 1.06 0L9 11.69l3.756-3.756a.75.75 0 0 1 .985-.066 12.698 12.698 0 0 1 4.575 6.832l.308 1.149 2.277-3.943a.75.75 0 1 1 1.299.75l-3.182 5.51a.75.75 0 0 1-1.025.275l-5.511-3.181a.75.75 0 0 1 .75-1.3l3.943 2.277-.308-1.149a11.194 11.194 0 0 0-3.528-5.617l-3.809 3.81a.75.75 0 0 1-1.06 0L1.72 6.53a.75.75 0 0 1 0-1.061Z","clip-rule":"evenodd"})])}function _e(t,a){return v(),g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[o("path",{"fill-rule":"evenodd",d:"M15.22 6.268a.75.75 0 0 1 .968-.431l5.942 2.28a.75.75 0 0 1 .431.97l-2.28 5.94a.75.75 0 1 1-1.4-.537l1.63-4.251-1.086.484a11.2 11.2 0 0 0-5.45 5.173.75.75 0 0 1-1.199.19L9 12.312l-6.22 6.22a.75.75 0 0 1-1.06-1.061l6.75-6.75a.75.75 0 0 1 1.06 0l3.606 3.606a12.695 12.695 0 0 1 5.68-4.974l1.086-.483-4.251-1.632a.75.75 0 0 1-.432-.97Z","clip-rule":"evenodd"})])}function A(t,a){return v(),g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[o("path",{"fill-rule":"evenodd",d:"M12.53 16.28a.75.75 0 0 1-1.06 0l-7.5-7.5a.75.75 0 0 1 1.06-1.06L12 14.69l6.97-6.97a.75.75 0 1 1 1.06 1.06l-7.5 7.5Z","clip-rule":"evenodd"})])}function Se(t,a){return v(),g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[o("path",{d:"M10.464 8.746c.227-.18.497-.311.786-.394v2.795a2.252 2.252 0 0 1-.786-.393c-.394-.313-.546-.681-.546-1.004 0-.323.152-.691.546-1.004ZM12.75 15.662v-2.824c.347.085.664.228.921.421.427.32.579.686.579.991 0 .305-.152.671-.579.991a2.534 2.534 0 0 1-.921.42Z"}),o("path",{"fill-rule":"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v.816a3.836 3.836 0 0 0-1.72.756c-.712.566-1.112 1.35-1.112 2.178 0 .829.4 1.612 1.113 2.178.502.4 1.102.647 1.719.756v2.978a2.536 2.536 0 0 1-.921-.421l-.879-.66a.75.75 0 0 0-.9 1.2l.879.66c.533.4 1.169.645 1.821.75V18a.75.75 0 0 0 1.5 0v-.81a4.124 4.124 0 0 0 1.821-.749c.745-.559 1.179-1.344 1.179-2.191 0-.847-.434-1.632-1.179-2.191a4.122 4.122 0 0 0-1.821-.75V8.354c.29.082.559.213.786.393l.415.33a.75.75 0 0 0 .933-1.175l-.415-.33a3.836 3.836 0 0 0-1.719-.755V6Z","clip-rule":"evenodd"})])}const Z=M("modal",()=>{const t=u(!1),a=u(!1);return b(a,n=>{n&&setTimeout(()=>t.value=!0,150)}),b(t,n=>{n||setTimeout(()=>a.value=!1,300)}),{isRendered:t,showModal:a}}),K={class:"bg-slate-100 dark:bg-gray-900 p-4 rounded-lg shadow-xl w-90"},z={__name:"Modal",setup(t){const a=Z(),n=()=>a.isRendered=!1;return(i,m)=>d(a).showModal?(v(),g("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30",onClick:R(n,["self"])},[f(V,{name:"slide-down"},{default:y(()=>[h(o("div",K,[N(i.$slots,"default",{},void 0,!0)],512),[[S,d(a).isRendered]])]),_:3})])):L("",!0)}},ke=T(z,[["__scopeId","data-v-fae993be"]]);function Y(t,a){return v(),g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[o("path",{"fill-rule":"evenodd",d:"M10.47 2.22a.75.75 0 0 1 1.06 0l2.25 2.25a.75.75 0 0 1 0 1.06l-2.25 2.25a.75.75 0 1 1-1.06-1.06l.97-.97H5.75a.75.75 0 0 1 0-1.5h5.69l-.97-.97a.75.75 0 0 1 0-1.06Zm-4.94 6a.75.75 0 0 1 0 1.06l-.97.97h5.69a.75.75 0 0 1 0 1.5H4.56l.97.97a.75.75 0 1 1-1.06 1.06l-2.25-2.25a.75.75 0 0 1 0-1.06l2.25-2.25a.75.75 0 0 1 1.06 0Z","clip-rule":"evenodd"})])}const G=M("balance",()=>{const t=u(""),a=u(""),n=u({totalIngreso:0,totalGasto:0,balance:0}),m=u(function(){const c=new Date,r=c.getFullYear(),e=String(c.getMonth()+1).padStart(2,"0");return t.value=`${r}-${e}-01 00:00:00`,a.value=new Date(r,e,0).toISOString().split("T")[0]+" 23:59:59",`${r}-${e}`}());b(m,c=>{const[r,e]=c.split("-");t.value=`${r}-${e}-01 00:00:00`,a.value=new Date(r,e,0).toISOString().split("T")[0]+" 23:59:59"}),b([t,a],async()=>await l());const l=async()=>{try{const c=await x.get(`/movements/balance?startDate=${t.value}&endDate=${a.value}`);n.value=c.data}catch(c){console.error("Error al obtener el balance:",c),w.fire({title:"Error al obtener balance",icon:"error",toast:!0,position:"top",timer:3e3,showConfirmButton:!1,timerProgressBar:!0})}};return{selectedMonth:m,startDate:t,endDate:a,balance:n,fetchBalance:l}}),J=M("graph",()=>{const t=G(),a=u({labels:[],datasets:[{label:"total",data:[],backgroundColor:["#60a5fa","#f87171","#34d399","#fbbf24","#a78bfa","#fb7185","#facc15","#38bdf8"]}]}),n=u({labels:[],datasets:[{label:"total",data:[],backgroundColor:["#60a5fa","#f87171","#34d399","#fbbf24","#a78bfa","#fb7185","#facc15","#38bdf8"]}]}),i=u(0),m=u(1),l=async()=>{const c=t.startDate,r=t.endDate;try{const e=await x.get(`/stats/totalByCategory?startDate=${c}&endDate=${r}`),{data:s}=e;n.value.labels=s.totalGastoByCategory.map(p=>p.Category.name),n.value.datasets[0].data=s.totalGastoByCategory.map(p=>Number(p.total)),a.value.labels=s.totalIngresoByCategory.map(p=>p.Category.name),a.value.datasets[0].data=s.totalIngresoByCategory.map(p=>Number(p.total)),i.value+=1,m.value+=1}catch(e){console.error("Error al cargar datos del gráfico:",e)}};return b(()=>[t.startDate,t.endDate],()=>l()),{chartDataIngreso:a,chartDataGasto:n,getTotalByCategory:l,chartKeyA:i,chartKeyB:m}}),Q=M("movement",()=>{const t=G(),a=J(),n=u(!1),i=u({});return{saveMovement:async(l,c)=>{try{c?await x.put(`/movements/${l.id}`,l):await x.post("/movements",l),t.fetchBalance(),a.getTotalByCategory(t.startDate,t.endDate),n.value=!0,i.value=l}catch(r){n.value=!1,console.error("Error al registrar movimiento",r)}},isSaved:n,mov:i}}),W=()=>{const t=Q(),a=Z(),n=u({type:"ingreso",amount:"",description:"",CategoryId:""}),i=async r=>{if(n.value.amount=l.value.replace(/\D/g,""),r&&!(await w.fire({title:"¿Desea Editar Registro?",icon:"question",showCancelButton:!0,confirmButtonText:"Sí, Editar",cancelButtonText:"Cancelar",theme:"auto"})).isConfirmed){a.showModal=!1,m(),w.fire({title:"Edicion Cancelada",icon:"success",toast:!0,position:"top",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,theme:"auto"});return}w.fire({title:r?"Editando":"Guardando...",allowOutsideClick:!1,didOpen:()=>{w.showLoading()},theme:"auto"}),await t.saveMovement(n.value,r),w.close(),a.isRendered=!1,t.isSaved?w.fire({title:`Movimiento ${r?"Editado":"Registrado"}`,icon:"success",toast:!0,position:"top",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,theme:"auto"}):w.fire({title:`Error al ${r?"Editar":"Registrar"} movimiento`,icon:"error",toast:!0,position:"top",timer:3e3,showConfirmButton:!1,timerProgressBar:!0,theme:"auto"}),a.showModal=!1,m()},m=()=>{n.value={type:"ingreso",amount:"",description:"",categoryId:"",id:""},t.isSaved=!1},l=u("");function c(r){const e=r.target.value.replace(/\D/g,"");if(e===""){l.value="";return}const s=parseInt(e,10);if(isNaN(s)){l.value="";return}l.value=k(s)}return{movement:n,submitForm:i,handleInput:c,valor:l,modalStore:a,formatoMoneda:k}},X={class:"w-full"},ee={key:0,class:"flex items-center gap-2"},te={key:1},ae={class:"max-h-60 p-2 overflow-y-auto mt-2 rounded-md bg-white dark:bg-gray-800 shadow-lg border border-gray-200 dark:border-gray-700 max-h-60"},oe={class:"grid grid-cols-4 gap-3"},re=["onClick"],se={class:"text-xs mt-1 text-center"},le={__name:"CategorySelect",props:{movement:{required:!0,type:Object}},setup(t){const a=t,n=F(),i=u(!1),m=()=>i.value=!i.value,l=u(null),c=r=>{a.movement.CategoryId=r.id,l.value=r,i.value=!1};return O(()=>{const r=n.categories.find(e=>e.id===a.movement.CategoryId);r&&(l.value=r)}),(r,e)=>(v(),g("div",X,[o("button",{onClick:m,type:"button",class:"w-full flex items-center justify-between p-2 border border-gray-300 rounded-md shadow-sm dark:bg-gray-800 dark:border-gray-700 text-left"},[l.value?(v(),g("div",ee,[o("div",{class:$([[d(D)(l.value.icon)],"rounded-full p-1 text-white text-lg"])},[f(d(I),{icon:l.value.icon,class:"w-5 h-5"},null,8,["icon"])],2),o("span",null,C(l.value.name),1)])):(v(),g("span",te,"Selecciona Categoria")),f(d(A),{class:"w-5 h-5 text-gray-400"})]),f(V,{name:"slide-down"},{default:y(()=>[h(o("div",ae,[o("div",oe,[(v(!0),g(U,null,H(d(n).categories,s=>(v(),g("div",{key:s.id,onClick:p=>c(s),class:$(["flex p-2 flex-col items-center rounded-lg cursor-pointer transition-all",{"bg-primary-100 dark:bg-primary-900 border-2 border-gray-200 dark:border-gray-500":t.movement.CategoryId===s.id,"hover:bg-gray-200 dark:hover:bg-gray-700":t.movement.CategoryId!==s.id}])},[o("div",{class:$([[d(D)(s.icon)],"rounded-full p-1 text-white text-lg hover:scale-110 duration-200"])},[f(d(I),{icon:s.icon},null,8,["icon"])],2),o("span",se,C(s.name),1)],10,re))),128))])],512),[[S,i.value]])]),_:1})]))}},ne=T(le,[["__scopeId","data-v-ecf38057"]]),ie={class:"mx-auto p-4 border border-gray-300 rounded-lg shadow-lg bg-slate-100 dark:bg-gray-900 dark:text-gray-100 dark:border-gray-700"},de={class:"text-2xl font-semibold mb-4"},ce={class:"flex flex-col w-full"},ue={class:"w-full flex gap-4"},me={class:"inline-flex items-center gap-2 cursor-pointer"},fe={class:"inline-flex items-center gap-2 cursor-pointer"},ge={class:"w-full"},ve={class:"w-full"},pe={class:"w-full"},we={class:"flex gap-2"},Be={__name:"MovementForm",props:P(["isEdit","data"],{isEdit:!1}),setup(t){const{handleInput:a,formatoMoneda:n,movement:i,submitForm:m,valor:l,modalStore:c}=W();return j(async()=>{if(t.isEdit&&t.data){const r=new Date(t.data.date),e=p=>p.toString().padStart(2,"0"),s=`${r.getFullYear()}-${e(r.getMonth()+1)}-${e(r.getDate())}T${e(r.getHours())}:${e(r.getMinutes())}`;i.value={...t.data,date:s},l.value=n(t.data.amount),await F().getCategories()}}),(r,e)=>(v(),g("div",ie,[o("h2",de,C(t.isEdit?"Editar":"Registrar")+" Movimiento",1),o("form",{onSubmit:e[6]||(e[6]=R(s=>d(m)(t.isEdit),["prevent"])),class:"flex flex-col gap-4 items-end",autocomplete:"off"},[h(o("div",ce,[e[7]||(e[7]=o("label",{for:"createdAt"},"Fecha",-1)),f(_,{id:"createdAt",type:"datetime-local",modelValue:d(i).date,"onUpdate:modelValue":e[0]||(e[0]=s=>d(i).date=s)},null,8,["modelValue"])],512),[[S,t.isEdit]]),o("div",ue,[o("label",me,[h(o("input",{id:"ingreso",type:"radio",value:"ingreso","onUpdate:modelValue":e[1]||(e[1]=s=>d(i).type=s),class:"form-radio h-5 w-5"},null,512),[[B,d(i).type]]),e[8]||(e[8]=o("span",null,"Ingreso",-1))]),o("label",fe,[h(o("input",{id:"gasto",type:"radio",value:"gasto","onUpdate:modelValue":e[2]||(e[2]=s=>d(i).type=s),class:"form-radio h-5 w-5"},null,512),[[B,d(i).type]]),e[9]||(e[9]=o("span",null,"Gasto",-1))])]),o("div",ge,[f(ne,{movement:d(i)},null,8,["movement"])]),o("div",ve,[e[10]||(e[10]=o("label",{for:"amount",class:"block text-gray-700 dark:text-gray-300"},"Monto",-1)),f(_,{type:"tel",id:"amount",modelValue:d(l),"onUpdate:modelValue":e[3]||(e[3]=s=>q(l)?l.value=s:null),required:"",onInput:d(a)},null,8,["modelValue","onInput"])]),o("div",pe,[e[11]||(e[11]=o("label",{for:"description",class:"block text-gray-700 dark:text-gray-300"},"Descripción",-1)),f(_,{id:"description",modelValue:d(i).description,"onUpdate:modelValue":e[4]||(e[4]=s=>d(i).description=s),modelModifiers:{trim:!0}},null,8,["modelValue"])]),o("div",we,[f(E,{type:"submit",class:"flex gap-2 items-center"},{default:y(()=>[o("span",null,C(t.isEdit?"Editar":"Crear")+" Movimiento",1),f(d(Y),{class:"w-5 inline"})]),_:1}),f(E,{color:"danger",onClick:e[5]||(e[5]=s=>d(c).isRendered=!1)},{default:y(()=>e[12]||(e[12]=[o("span",null,"Cerrar",-1)])),_:1})])],32)]))}};export{ke as M,Be as _,G as a,$e as b,Se as c,J as d,Q as e,_e as r,Z as u};
