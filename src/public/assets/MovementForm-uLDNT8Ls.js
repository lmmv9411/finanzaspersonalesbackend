import{z as x,r as m,g as b,_ as R,c as y,A as N,u as l,o as v,b as g,w,p as C,B as I,a as n,C as V,T as O,D as E,m as h,E as G,n as P,G as U,H as A,t as D,I as B,F as H,y as z,x as L}from"./index-6yIVpIIz.js";import{S as p,_ as M,a as $}from"./BaseInput-HaCwFjNR.js";import{u as k}from"./categoriesStore-Crxyu36l.js";const F=x("modal",()=>{const t=m(!1),r=m(!1);return b(r,o=>{o&&setTimeout(()=>t.value=!0,150)}),b(t,o=>{o||setTimeout(()=>r.value=!1,300)}),{isRendered:t,showModal:r}}),q={class:"bg-slate-100 dark:bg-gray-900 p-4 rounded-lg shadow-xl w-90"},K={__name:"Modal",setup(t){const r=F(),o=()=>r.isRendered=!1;return(u,i)=>l(r).showModal?(v(),y("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30",onClick:E(o,["self"])},[g(O,{name:"slide-down"},{default:w(()=>[C(n("div",q,[V(u.$slots,"default",{},void 0,!0)],512),[[I,l(r).isRendered]])]),_:3})])):N("",!0)}},fe=R(K,[["__scopeId","data-v-fae993be"]]),T=x("balance",()=>{const t=m(""),r=m(""),o=m({totalIngreso:0,totalGasto:0,balance:0}),i=m(function(){const s=new Date,e=s.getFullYear(),a=String(s.getMonth()+1).padStart(2,"0");return t.value=`${e}-${a}-01 00:00:00`,r.value=new Date(e,a,0).toISOString().split("T")[0]+" 23:59:59",`${e}-${a}`}());b(i,s=>{const[e,a]=s.split("-");t.value=`${e}-${a}-01 00:00:00`,r.value=new Date(e,a,0).toISOString().split("T")[0]+" 23:59:59"}),b([t,r],async()=>await f());const d=s=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}).format(s),f=async()=>{try{const s=await h.get(`/movements/balance?startDate=${t.value}&endDate=${r.value}`);o.value=s.data}catch(s){console.error("Error al obtener el balance:",s),p.fire({title:"Error al obtener balance",icon:"error",toast:!0,position:"top",timer:3e3,showConfirmButton:!1,timerProgressBar:!0})}};return{selectedMonth:i,formatCurrency:d,startDate:t,endDate:r,balance:o,fetchBalance:f}}),Y=x("graph",()=>{const t=T(),r=m({labels:[],datasets:[{label:"total",data:[],backgroundColor:["#60a5fa","#f87171","#34d399","#fbbf24","#a78bfa","#fb7185","#facc15","#38bdf8"]}]}),o=m({labels:[],datasets:[{label:"total",data:[],backgroundColor:["#60a5fa","#f87171","#34d399","#fbbf24","#a78bfa","#fb7185","#facc15","#38bdf8"]}]}),u=m(0),i=m(1),d=async()=>{const f=t.startDate,s=t.endDate;try{const e=await h.get(`/stats/totalByCategory?startDate=${f}&endDate=${s}`),{data:a}=e;o.value.labels=a.totalGastoByCategory.map(c=>c.Category.name),o.value.datasets[0].data=a.totalGastoByCategory.map(c=>Number(c.total)),r.value.labels=a.totalIngresoByCategory.map(c=>c.Category.name),r.value.datasets[0].data=a.totalIngresoByCategory.map(c=>Number(c.total)),u.value+=1,i.value+=1}catch(e){console.error("Error al cargar datos del gráfico:",e)}};return b(()=>[t.startDate,t.endDate],()=>d()),{chartDataIngreso:r,chartDataGasto:o,getTotalByCategory:d,chartKeyA:u,chartKeyB:i}}),Z=x("movement",()=>{const t=T(),r=Y();return{saveMovement:async(u,i)=>{try{return i?await h.put(`/movements/${u.id}`,u):await h.post("/movements",u),t.fetchBalance(),r.getTotalByCategory(t.startDate,t.endDate),!0}catch(d){return console.error("Error al registrar movimiento",d),!1}}}}),j=()=>{const t=Z(),r=F(),o=m({type:"ingreso",amount:"",description:"",CategoryId:""}),u=async s=>{if(o.value.amount=d.value.replace(/\D/g,""),s&&!(await p.fire({title:"¿Desea Editar Registro?",icon:"question",showCancelButton:!0,confirmButtonText:"Sí, Editar",cancelButtonText:"Cancelar",theme:"auto"})).isConfirmed){r.showModal=!1,i(),p.fire({title:"Edicion Cancelada",icon:"success",toast:!0,position:"top",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,theme:"auto"});return}p.fire({title:s?"Editando":"Guardando...",allowOutsideClick:!1,didOpen:()=>{p.showLoading()},theme:"auto"});const e=await t.saveMovement(o.value,s);p.close(),r.isRendered=!1,e?p.fire({title:`Movimiento ${s?"Editado":"Registrado"}`,icon:"success",toast:!0,position:"top",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,theme:"auto"}):p.fire({title:`Error al ${s?"Editar":"Registrar"} movimiento`,icon:"error",toast:!0,position:"top",timer:3e3,showConfirmButton:!1,timerProgressBar:!0,theme:"auto"}),r.showModal=!1,i()},i=()=>{o.value={type:"ingreso",amount:"",description:"",categoryId:"",id:""}},d=m("");function f(s,e=!0){let a=s;if(e&&(a=s.target.value.replace(/\D/g,"")),a===""){d.value="";return}const c=parseInt(a,10);if(isNaN(c)){d.value="";return}const S=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0});d.value=S.format(c)}return{movement:o,submitForm:u,formatearComoMoneda:f,valor:d,modalStore:r}},J=["id","value","placeholder","disabled"],Q="w-full dark:text-gray-200 text-gray-600 px-3 py-2 border rounded-sm focus:outline-none transition duration-300 focus:ring-2",W={__name:"BaseSelect",props:{modelValue:String,placeholder:String,id:String,color:{type:String,default:"primary"},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(t,{emit:r}){const o=t,u={primary:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500",danger:"border-red-300 focus:border-red-500 focus:ring-red-500"},i=G(()=>u[o.color]??u.primary);return(d,f)=>(v(),y("select",{id:t.id,value:t.modelValue,placeholder:t.placeholder,disabled:t.disabled,class:P([Q,i.value,t.disabled?"opacity-50 cursor-not-allowed":""]),onInput:f[0]||(f[0]=s=>d.$emit("update:modelValue",s.target.value))},[V(d.$slots,"default")],42,J))}};function X(t,r){return v(),y("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[n("path",{"fill-rule":"evenodd",d:"M10.47 2.22a.75.75 0 0 1 1.06 0l2.25 2.25a.75.75 0 0 1 0 1.06l-2.25 2.25a.75.75 0 1 1-1.06-1.06l.97-.97H5.75a.75.75 0 0 1 0-1.5h5.69l-.97-.97a.75.75 0 0 1 0-1.06Zm-4.94 6a.75.75 0 0 1 0 1.06l-.97.97h5.69a.75.75 0 0 1 0 1.5H4.56l.97.97a.75.75 0 1 1-1.06 1.06l-2.25-2.25a.75.75 0 0 1 0-1.06l2.25-2.25a.75.75 0 0 1 1.06 0Z","clip-rule":"evenodd"})])}const _={class:"mx-auto p-4 border border-gray-300 rounded-lg shadow-lg bg-slate-100 dark:bg-gray-900 dark:text-gray-100 dark:border-gray-700"},ee={class:"text-2xl font-semibold mb-4"},te={class:"flex flex-col w-full"},ae={class:"w-full flex gap-4"},oe={class:"inline-flex items-center gap-2 cursor-pointer"},re={class:"inline-flex items-center gap-2 cursor-pointer"},se={class:"w-full"},ne=["value"],le={class:"w-full"},ie={class:"w-full"},de={class:"flex gap-2"},ge={__name:"MovementForm",props:U(["isEdit","data"],{isEdit:!1}),setup(t){const{formatearComoMoneda:r,movement:o,submitForm:u,valor:i,modalStore:d}=j(),f=k();return A(async()=>{if(t.isEdit&&t.data){const s=t.data.date,e=new Date(s),a=S=>S.toString().padStart(2,"0"),c=`${e.getFullYear()}-${a(e.getMonth()+1)}-${a(e.getDate())}T${a(e.getHours())}:${a(e.getMinutes())}`;o.value={type:t.data.type,CategoryId:t.data.CategoryId,amount:t.data.amount,description:t.data.description,id:t.data.id,date:c},r(t.data.amount,!1),await k().getCategories()}}),(s,e)=>(v(),y("div",_,[n("h2",ee,D(t.isEdit?"Editar":"Registrar")+" Movimiento",1),n("form",{onSubmit:e[7]||(e[7]=E(a=>l(u)(t.isEdit),["prevent"])),class:"flex flex-col gap-4 items-end",autocomplete:"off"},[C(n("div",te,[e[8]||(e[8]=n("label",{for:"createdAt"},"Fecha",-1)),g(M,{id:"createdAt",type:"datetime-local",modelValue:l(o).date,"onUpdate:modelValue":e[0]||(e[0]=a=>l(o).date=a)},null,8,["modelValue"])],512),[[I,t.isEdit]]),n("div",ae,[n("label",oe,[C(n("input",{type:"radio",value:"ingreso","onUpdate:modelValue":e[1]||(e[1]=a=>l(o).type=a),class:"form-radio h-5 w-5"},null,512),[[B,l(o).type]]),e[9]||(e[9]=n("span",{class:""},"Ingreso",-1))]),n("label",re,[C(n("input",{type:"radio",value:"gasto","onUpdate:modelValue":e[2]||(e[2]=a=>l(o).type=a),class:"form-radio h-5 w-5"},null,512),[[B,l(o).type]]),e[10]||(e[10]=n("span",{class:""},"Gasto",-1))])]),n("div",se,[e[12]||(e[12]=n("label",{for:"category",class:"block text-gray-700 dark:text-gray-300"},"Categoría",-1)),g(W,{id:"category",modelValue:l(o).CategoryId,"onUpdate:modelValue":e[3]||(e[3]=a=>l(o).CategoryId=a)},{default:w(()=>[e[11]||(e[11]=n("option",{value:"",disabled:""},"Selecciona una categoría",-1)),(v(!0),y(H,null,z(l(f).categories,a=>(v(),y("option",{key:a.id,value:a.id},D(a.name),9,ne))),128))]),_:1},8,["modelValue"])]),n("div",le,[e[13]||(e[13]=n("label",{for:"amount",class:"block text-gray-700 dark:text-gray-300"},"Monto",-1)),g(M,{type:"tel",id:"amount",modelValue:l(i),"onUpdate:modelValue":e[4]||(e[4]=a=>L(i)?i.value=a:null),required:"",onInput:l(r)},null,8,["modelValue","onInput"])]),n("div",ie,[e[14]||(e[14]=n("label",{for:"description",class:"block text-gray-700 dark:text-gray-300"},"Descripción",-1)),g(M,{id:"description",modelValue:l(o).description,"onUpdate:modelValue":e[5]||(e[5]=a=>l(o).description=a)},null,8,["modelValue"])]),n("div",de,[g($,{type:"submit",class:"flex gap-2 items-center"},{default:w(()=>[n("span",null,D(t.isEdit?"Editar":"Crear")+" Movimiento",1),g(l(X),{class:"w-5 inline"})]),_:1}),g($,{color:"danger",onClick:e[6]||(e[6]=a=>l(d).isRendered=!1)},{default:w(()=>e[15]||(e[15]=[n("span",null,"Cerrar",-1)])),_:1})])],32)]))}};export{fe as M,ge as _,T as a,Y as b,F as u};
